<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diamond Rebate Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500&family=Noto+Sans+SC:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #0B0E14;
            --surface-glass: rgba(30, 35, 48, 0.75);
            --surface-solid: #1C212E;
            --border-subtle: rgba(255, 255, 255, 0.08);
            --accent-gold: #FACC15;
            --accent-gold-glow: rgba(250, 204, 21, 0.25);
            --accent-green: #34D399;
            --accent-red: #F43F5E;
            --text-main: #FFFFFF;
            --text-muted: #94A3B8;
            --text-dim: #64748B;
            --text-highlight: #E2E8F0;
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 8px;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body {
            margin: 0;
            /* å¢åŠ åº•éƒ¨ Paddingï¼Œç¢ºä¿æ»‘åˆ°åº•éƒ¨æ™‚ä¸æœƒè¢«åˆ‡æ‰ */
            padding: 16px 16px 60px 16px;
            background-color: var(--bg-body);
            font-family: 'Inter', 'Noto Sans TC', 'Noto Sans SC', 'Noto Sans JP', sans-serif;
            color: var(--text-main);
            background-image: 
                radial-gradient(circle at 10% 10%, rgba(244, 63, 94, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 90% 90%, rgba(250, 204, 21, 0.1) 0%, transparent 50%);
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 480px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            /* â˜… ä¿®æ”¹é‡é»ï¼šå¢åŠ å€å¡Šé–“è·ï¼Œå¾ 16px æ”¹ç‚º 24px */
            gap: 24px;
            position: relative;
        }

        /* --- èªè¨€åˆ‡æ› (å³ä¸Šè§’) --- */
        .lang-switch-container {
            position: absolute;
            top: 0;
            right: 0;
            display: flex;
            gap: 4px;
            z-index: 20;
        }

        .lang-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: var(--text-muted);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            backdrop-filter: blur(4px);
        }

        .lang-btn:hover { background: rgba(255, 255, 255, 0.1); color: var(--text-main); }
        .lang-btn.active { background: var(--accent-gold); color: #000; border-color: var(--accent-gold); font-weight: 700; box-shadow: 0 0 8px var(--accent-gold-glow); }

        /* --- Header --- */
        .promo-header { 
            text-align: center; 
            margin-top: 16px; /* å¢åŠ é ‚éƒ¨ç©ºé–“ï¼Œé¿å…èˆ‡èªè¨€æŒ‰éˆ•å¤ªè¿‘ */
            padding-top: 10px;
        }
        .promo-title {
            margin: 0; font-size: 24px; font-weight: 800;
            background: linear-gradient(135deg, #FFF 30%, var(--accent-gold) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px; line-height: 1.2; margin-bottom: 8px;
        }
        .promo-subtitle { font-size: 12px; color: var(--text-muted); margin: 0 0 16px 0; }
        .game-tags { display: flex; justify-content: center; flex-wrap: wrap; gap: 6px; }
        .game-tag {
            font-size: 10px; padding: 3px 8px; border-radius: 20px;
            background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-subtle);
            color: var(--text-highlight); display: flex; align-items: center; gap: 4px;
        }

        /* --- Cards --- */
        .card {
            background: var(--surface-glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-subtle); border-radius: var(--radius-lg);
            overflow: hidden; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); transition: transform 0.2s;
        }
        .hero-card {
            padding: 24px 20px; /* å¢åŠ å…§è· */
            text-align: center;
            background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0) 100%);
            border: 1px solid rgba(250, 204, 21, 0.3); box-shadow: 0 0 40px -10px var(--accent-gold-glow);
        }
        .hero-label { font-size: 12px; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 6px; }
        .hero-value { font-size: 42px; font-weight: 800; color: var(--accent-gold); text-shadow: 0 0 30px var(--accent-gold-glow); margin: 0; line-height: 1.1; font-variant-numeric: tabular-nums; }
        
        .bento-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .stat-card { display: flex; flex-direction: column; justify-content: center; padding: 20px 16px; }
        .stat-label { font-size: 11px; color: var(--text-muted); margin-bottom: 6px; }
        .stat-value { font-size: 18px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }

        /* --- Progress Bar --- */
        .progress-section { margin-top: 24px; text-align: left; }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 11px; color: var(--text-muted); font-weight: 600; }
        .progress-track { height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-gold), #FFF); width: 0%; border-radius: 10px; transition: width 1.2s cubic-bezier(0.22, 1, 0.36, 1); box-shadow: 0 0 15px var(--accent-gold-glow); }

        /* --- Titles & Tables --- */
        .section-title {
            font-size: 14px; font-weight: 700; color: var(--text-highlight);
            margin-bottom: 14px; /* å¢åŠ æ¨™é¡Œèˆ‡å…§å®¹çš„è·é›¢ */
            padding-left: 6px; border-left: 3px solid var(--accent-gold); line-height: 1.2;
        }
        .tier-list { display: flex; flex-direction: column; gap: 10px; }
        .tier-item { display: flex; justify-content: space-between; align-items: center; background: var(--surface-solid); padding: 14px 16px; border-radius: var(--radius-sm); border: 1px solid transparent; transition: all 0.3s; }
        .tier-item.active { background: rgba(250, 204, 21, 0.1); border-color: rgba(250, 204, 21, 0.3); transform: scale(1.02); box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .tier-range { font-size: 12px; color: var(--text-muted); }
        .tier-rate { font-size: 15px; font-weight: 800; color: var(--text-main); }
        .tier-item.active .tier-rate { color: var(--accent-gold); }

        .history-card { padding: 0; }
        .history-table { width: 100%; border-collapse: collapse; font-size: 12px; text-align: left; }
        .history-table th { background: rgba(255, 255, 255, 0.03); color: var(--text-muted); font-weight: 600; padding: 12px 14px; font-size: 11px; text-transform: uppercase; border-bottom: 1px solid var(--border-subtle); }
        .history-table td { padding: 12px 14px; border-bottom: 1px solid var(--border-subtle); color: var(--text-main); vertical-align: middle; }
        .history-table tr:last-child td { border-bottom: none; }
        .col-amount { text-align: right; font-family: 'JetBrains Mono', monospace; letter-spacing: -0.5px; }

        .row-daily-total { background: rgba(250, 204, 21, 0.08) !important; }
        .row-daily-total .col-game { color: var(--accent-gold); font-weight: 800; display: flex; align-items: center; gap: 6px; }
        .row-daily-total .col-game::before { content: 'âˆ‘'; font-weight: 400; opacity: 0.7; }
        .row-daily-total .col-amount { color: var(--accent-gold); font-weight: 800; font-size: 13px; }
        .date-dim { opacity: 0.2; font-family: serif; }

        /* --- Footer (å¤§å¹…å„ªåŒ–) --- */
        .footer-rules { 
            /* â˜… ä¿®æ”¹é‡é»ï¼šå¢åŠ ä¸Šæ–¹èˆ‡è¡¨æ ¼çš„è·é›¢ */
            margin-top: 32px; 
            padding-top: 24px;
            border-top: 1px solid var(--border-subtle); 
            color: var(--text-muted); 
        }
        .footer-title { font-size: 13px; font-weight: 700; color: var(--text-dim); margin-bottom: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .rules-list { 
            list-style: none; padding: 0; margin: 0; 
            font-size: 12px; 
            /* â˜… ä¿®æ”¹é‡é»ï¼šå¢åŠ è¡Œé«˜ï¼Œé¿å…æ–‡å­—æ“ åœ¨ä¸€èµ· */
            line-height: 1.8; 
            color: var(--text-muted); 
        }
        .rules-list li { position: relative; padding-left: 14px; margin-bottom: 8px; }
        .rules-list li::before { content: "â€¢"; position: absolute; left: 0; color: var(--text-dim); }
        .rule-highlight { color: var(--accent-gold); font-family: 'JetBrains Mono', monospace; background: rgba(250, 204, 21, 0.1); padding: 0 4px; border-radius: 4px; }
        .copyright { margin-top: 40px; text-align: center; font-size: 10px; color: var(--text-dim); opacity: 0.6; }

        /* --- Skeleton & Error --- */
        .skeleton { background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%); background-size: 200% 100%; animation: pulse 1.5s infinite; color: transparent !important; border-radius: 4px; }
        @keyframes pulse { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        
        .error-msg { text-align: center; padding: 20px; color: var(--text-muted); background: var(--surface-glass); border-radius: var(--radius-md); border: 1px dashed var(--border-subtle); margin-top: 30px; font-size: 13px; }
    </style>
</head>
<body>

    <div class="dashboard-container">
        
        <!-- Language Switcher (Top Right Absolute) -->
        <div class="lang-switch-container">
            <button class="lang-btn active" onclick="changeLang('zh-TW')">ç¹</button>
            <button class="lang-btn" onclick="changeLang('zh-CN')">ç®€</button>
            <button class="lang-btn" onclick="changeLang('en')">EN</button>
            <button class="lang-btn" onclick="changeLang('jp')">JP</button>
        </div>

        <!-- APP Content Wrapper -->
        <div id="app-content">
            <!-- Header -->
            <header class="promo-header">
                <h1 class="promo-title" data-i18n="title">ç›´æ’­é–“éŠæˆ²<br>å¤©å¤©è¿”é‘½çŸ³ ğŸ’</h1>
                <p class="promo-subtitle" data-i18n="subtitle">ç©ç›´æ’­é–“ä»»ä¸€æ¬¾éŠæˆ²ï¼Œå¤©å¤©è¿”é‘½çŸ³ï¼</p>
                <div class="game-tags">
                    <span class="game-tag" data-i18n="game_1">ğŸ‰ é¾ä¹³é¬¥ç™½è™</span>
                    <span class="game-tag" data-i18n="game_2">ğŸ’ˆ ä¸€æŸ±æ“å¤©</span>
                    <span class="game-tag" data-i18n="game_3">ğŸŒªï¸ é‡‘å°„ç‹‚é¢¨</span>
                </div>
            </header>

            <!-- Main Stats -->
            <main>
                <!-- Hero Card -->
                <div class="card hero-card">
                    <div class="hero-label" data-i18n="hero_label">âœ¨ é è¨ˆæ˜æ—¥è¿”æ°´ (é‘½)</div>
                    <div class="hero-value skeleton" id="val-rebate">00,000</div>
                    
                    <div class="progress-section">
                        <div class="progress-header">
                            <span id="tier-status">Loading...</span>
                            <span id="next-diff">---</span>
                        </div>
                        <div class="progress-track">
                            <div class="progress-fill" id="progress-bar"></div>
                        </div>
                    </div>
                </div>

                <!-- Bento Grid -->
                <div class="bento-grid" style="margin-top: 12px;">
                    <div class="card stat-card">
                        <div class="stat-label" data-i18n="daily_bet_label">ä»Šæ—¥ä¸‹æ³¨ç¸½é»æ•¸</div>
                        <div class="stat-value skeleton" id="val-total">0</div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-label" data-i18n="status_label">ç•¶å‰æ´»å‹•è³‡æ ¼</div>
                        <div class="stat-value" id="val-qualify" style="font-size: 13px;">---</div>
                    </div>
                </div>
            </main>

            <!-- Rules Section -->
            <section>
                <div class="section-title" data-i18n="rate_title">ğŸ“Š é‘½çŸ³å›é¥‹æ¯”ä¾‹</div>
                <div class="tier-list">
                    <div class="tier-item" id="tier-3">
                        <div class="tier-range" data-i18n="tier_3_range">1,000 è¬ä»¥ä¸Š</div>
                        <div class="tier-rate">1.8%</div>
                    </div>
                    <div class="tier-item" id="tier-2">
                        <div class="tier-range" data-i18n="tier_2_range">100 è¬ ~ 999 è¬</div>
                        <div class="tier-rate">1.4%</div>
                    </div>
                    <div class="tier-item" id="tier-1">
                        <div class="tier-range" data-i18n="tier_1_range">5,000 ~ 99 è¬</div>
                        <div class="tier-rate">0.7%</div>
                    </div>
                </div>
            </section>

            <!-- History Section -->
            <section>
                <div class="section-title" data-i18n="history_title">ğŸ“… è¿‘ 3 æ—¥ä¸‹æ³¨ç´€éŒ„</div>
                <div class="card history-card">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th width="20%" data-i18n="table_date">æ—¥æœŸ</th>
                                <th width="45%" data-i18n="table_game">éŠæˆ²</th>
                                <th width="35%" class="col-amount" data-i18n="table_amount">ä¸‹æ³¨ç¸½é¡</th>
                            </tr>
                        </thead>
                        <tbody id="history-tbody">
                            <tr>
                                <td><div class="skeleton" style="width:30px; height:12px;"></div></td>
                                <td><div class="skeleton" style="width:80px; height:12px;"></div></td>
                                <td><div class="skeleton" style="width:50px; height:12px; float:right;"></div></td>
                            </tr>
                            <tr>
                                <td><div class="skeleton" style="width:30px; height:12px;"></div></td>
                                <td><div class="skeleton" style="width:80px; height:12px;"></div></td>
                                <td><div class="skeleton" style="width:50px; height:12px; float:right;"></div></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Footer Info -->
            <footer class="footer-rules">
                <div class="footer-title" data-i18n="footer_title">â„¹ï¸ æ´»å‹•èªªæ˜</div>
                <ul class="rules-list" id="footer-rules-list"></ul>
                <div class="copyright">Â© 2025 SWAG. All Rights Reserved.</div>
            </footer>
        </div> <!-- End of app-content -->

    </div>

    <script>
        // â˜…â˜…â˜… è«‹æ›¿æ›æˆæ‚¨çš„ Cloud Run API ç¶²å€ (å‹™å¿…å¡«å¯«) â˜…â˜…â˜…
        const API_URL = 'https://script.google.com/macros/s/AKfycbwRSX20cx5_AJoo1dgXtLHqJikuYVswLcE7--Edn0gWEHUGa25YvveNqSifc0UmRk0B/exec';

        const fmt = (n) => new Intl.NumberFormat('en-US').format(n);
        let cachedData = null; 
        let currentLang = 'zh-TW';
        let currentError = null; 

        // --- å¤šèªç³»å­—å…¸ ---
        const TRANSLATIONS = {
            'zh-TW': {
                title: 'ç›´æ’­é–“éŠæˆ²<br>å¤©å¤©è¿”é‘½çŸ³ ğŸ’',
                subtitle: 'ç©ç›´æ’­é–“ä»»ä¸€æ¬¾éŠæˆ²ï¼Œå¤©å¤©è¿”é‘½çŸ³ï¼',
                game_1: 'ğŸ‰ é¾ä¹³é¬¥ç™½è™',
                game_2: 'ğŸ’ˆ ä¸€æŸ±æ“å¤©',
                game_3: 'ğŸŒªï¸ é‡‘å°„ç‹‚é¢¨',
                hero_label: 'âœ¨ é è¨ˆæ˜æ—¥è¿”æ°´ (é‘½)',
                daily_bet_label: 'ä»Šæ—¥ä¸‹æ³¨ç¸½é»æ•¸',
                status_label: 'ç•¶å‰æ´»å‹•è³‡æ ¼',
                rate_title: 'ğŸ“Š é‘½çŸ³å›é¥‹æ¯”ä¾‹',
                tier_3_range: '1,000 è¬ä»¥ä¸Š',
                tier_2_range: '100 è¬ ~ 999 è¬',
                tier_1_range: '5,000 ~ 99 è¬',
                history_title: 'ğŸ“… è¿‘ 3 æ—¥ä¸‹æ³¨ç´€éŒ„',
                table_date: 'æ—¥æœŸ',
                table_game: 'éŠæˆ²',
                table_amount: 'ä¸‹æ³¨ç¸½é¡',
                footer_title: 'â„¹ï¸ æ´»å‹•èªªæ˜',
                qualify_yes: 'âœ… ç¬¦åˆè³‡æ ¼',
                qualify_no: 'â³ å°šæœªé”æ¨™',
                tier_current: 'ç•¶å‰å±¤ç´š',
                tier_max: 'å·²é”æœ€é«˜å±¤ç´š ğŸš€',
                tier_diff: 'å·® {n} å‡ç´š',
                loading: 'è¼‰å…¥ä¸­...',
                no_record: 'å°šç„¡ç´€éŒ„',
                err_missing_title: 'âš ï¸ ç¼ºå°‘ç”¨æˆ¶è³‡è¨Š',
                err_missing_desc: 'ç„¡æ³•è®€å– User IDï¼Œè«‹ç¢ºèªé€£çµæ ¼å¼ã€‚',
                err_conn_title: 'é€£ç·šéŒ¯èª¤',
                err_conn_desc: 'ç„¡æ³•é€£æ¥è‡³ä¼ºæœå™¨ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚',
                err_data_title: 'æ•¸æ“šè®€å–å¤±æ•—',
                game_map: { 'é¾ä¹³é¬¥ç™½è™': 'é¾ä¹³é¬¥ç™½è™', 'ä¸€æŸ±æ“å¤©': 'ä¸€æŸ±æ“å¤©', 'é‡‘å°„ç‹‚é¢¨': 'é‡‘å°„ç‹‚é¢¨', 'ç•¶æ—¥åŠ ç¸½': 'ç•¶æ—¥åŠ ç¸½' },
                rules: [
                    'æ´»å‹•æœŸé–“ï¼Œæ¯æ—¥ä¸‹æ³¨ç¸½é¡æ»¿ <strong>5,000</strong> é‘½çŸ³å³äº«é‘½çŸ³è¿”é‚„ã€‚',
                    'æ´»å‹•æœŸé–“æ—¥æ—¥è¿”é‘½ï¼Œéš”æ—¥ 01:00 å‰ç™¼æ”¾è‡³æ‰€å±¬å¸³è™Ÿå…§ã€‚',
                    'èˆ‰ä¾‹ï¼š<span class="rule-highlight">11/29 01:00</span> å‰ç™¼æ”¾ 11/28 å…¨å¤©çš„è¿”é‘½ï¼Œæ™‚å€ç‚º UTC+8ã€‚',
                    'åƒ…è¨ˆç›´æ’­é–“ä¸‰æ¬¾éŠæˆ²ï¼šã€Œé¾ä¹³é¬¥ç™½è™ã€ã€ã€Œä¸€æŸ±æ“å¤©ã€ã€ã€Œé‡‘å°„ç‹‚é¢¨ã€ çš„æœ‰æ•ˆæŠ•æ³¨åŠ ç¸½é‘½çŸ³æ•¸ã€‚',
                    'è¿”é‘½æ•¸é‡å››æ¨äº”å…¥å°æ•¸é»å¾Œä¸€ä½ã€‚èˆ‰ä¾‹ï¼šå‰æ—¥ä¸‹æ³¨ 52,400 é‘½æ¬¡æ—¥è¿”æ°´ç‚º 52,400 * 0.7% = 366.8ï¼Œå¯¦éš›å°‡ç™¼æ”¾ <span class="rule-highlight">367</span> é‘½ã€‚',
                    'æŠ•æ³¨æ¨¡å¼ç•°å¸¸è€…ï¼Œç³»çµ±æœ‰æ¬Šå–æ¶ˆè¿”é‘½è³‡æ ¼ã€‚',
                    'è³‡æ–™éœ€ç™»å…¥å¸³è™Ÿä»¥æ­£ç¢ºé¡¯ç¤ºã€‚'
                ]
            },
            'zh-CN': {
                title: 'ç›´æ’­é—´æ¸¸æˆ<br>å¤©å¤©è¿”é’»çŸ³ ğŸ’',
                subtitle: 'ç©ç›´æ’­é—´ä»»ä¸€æ¬¾æ¸¸æˆï¼Œå¤©å¤©è¿”é’»çŸ³ï¼',
                game_1: 'ğŸ‰ é¾™ä¹³æ–—ç™½è™',
                game_2: 'ğŸ’ˆ ä¸€æŸ±æ“å¤©',
                game_3: 'ğŸŒªï¸ é‡‘å°„ç‹‚é£',
                hero_label: 'âœ¨ é¢„è®¡æ˜æ—¥è¿”æ°´ (é’»)',
                daily_bet_label: 'ä»Šæ—¥ä¸‹æ³¨æ€»ç‚¹æ•°',
                status_label: 'å½“å‰æ´»åŠ¨èµ„æ ¼',
                rate_title: 'ğŸ“Š é’»çŸ³å›é¦ˆæ¯”ä¾‹',
                tier_3_range: '1,000 ä¸‡ä»¥ä¸Š',
                tier_2_range: '100 ä¸‡ ~ 999 ä¸‡',
                tier_1_range: '5,000 ~ 99 ä¸‡',
                history_title: 'ğŸ“… è¿‘ 3 æ—¥ä¸‹æ³¨çºªå½•',
                table_date: 'æ—¥æœŸ',
                table_game: 'æ¸¸æˆ',
                table_amount: 'ä¸‹æ³¨æ€»é¢',
                footer_title: 'â„¹ï¸ æ´»åŠ¨è¯´æ˜',
                qualify_yes: 'âœ… ç¬¦åˆèµ„æ ¼',
                qualify_no: 'â³ å°šæœªè¾¾æ ‡',
                tier_current: 'å½“å‰å±‚çº§',
                tier_max: 'å·²è¾¾æœ€é«˜å±‚çº§ ğŸš€',
                tier_diff: 'å·® {n} å‡çº§',
                loading: 'åŠ è½½ä¸­...',
                no_record: 'å°šæ— çºªå½•',
                err_missing_title: 'âš ï¸ ç¼ºå°‘ç”¨æˆ·ä¿¡æ¯',
                err_missing_desc: 'æ— æ³•è¯»å– User IDï¼Œè¯·ç¡®è®¤è¿ç»“æ ¼å¼ã€‚',
                err_conn_title: 'è¿æ¥é”™è¯¯',
                err_conn_desc: 'æ— æ³•è¿æ¥è‡³æœåŠ¡å™¨ï¼Œè¯·ç¨åå†è¯•ã€‚',
                err_data_title: 'æ•°æ®è¯»å–å¤±è´¥',
                game_map: { 'é¾ä¹³é¬¥ç™½è™': 'é¾™ä¹³æ–—ç™½è™', 'ä¸€æŸ±æ“å¤©': 'ä¸€æŸ±æ“å¤©', 'é‡‘å°„ç‹‚é¢¨': 'é‡‘å°„ç‹‚é£', 'ç•¶æ—¥åŠ ç¸½': 'å½“æ—¥åŠ æ€»' },
                rules: [
                    'æ´»åŠ¨æœŸé—´ï¼Œæ¯æ—¥ä¸‹æ³¨æ€»é¢æ»¡ <strong>5,000</strong> é’»çŸ³å³äº«é’»çŸ³è¿”è¿˜ã€‚',
                    'æ´»åŠ¨æœŸé—´æ—¥æ—¥è¿”é’»ï¼Œéš”æ—¥ 01:00 å‰å‘æ”¾è‡³æ‰€å±å¸å·å†…ã€‚',
                    'ä¸¾ä¾‹ï¼š<span class="rule-highlight">11/29 01:00</span> å‰å‘æ”¾ 11/28 å…¨å¤©çš„è¿”é’»ï¼Œæ—¶åŒºä¸º UTC+8ã€‚',
                    'ä»…è®¡ç›´æ’­é—´ä¸‰æ¬¾æ¸¸æˆï¼šã€Œé¾™ä¹³æ–—ç™½è™ã€ã€ã€Œä¸€æŸ±æ“å¤©ã€ã€ã€Œé‡‘å°„ç‹‚é£ã€ çš„æœ‰æ•ˆæŠ•æ³¨åŠ æ€»é’»çŸ³æ•°ã€‚',
                    'è¿”é’»æ•°é‡å››èˆäº”å…¥å°æ•°ç‚¹åä¸€ä½ã€‚ä¸¾ä¾‹ï¼šå‰æ—¥ä¸‹æ³¨ 52,400 é’»æ¬¡æ—¥è¿”æ°´ä¸º 52,400 * 0.7% = 366.8ï¼Œå®é™…å°†å‘æ”¾ <span class="rule-highlight">367</span> é’»ã€‚',
                    'æŠ•æ³¨æ¨¡å¼å¼‚å¸¸è€…ï¼Œç³»ç»Ÿæœ‰æƒå–æ¶ˆè¿”é’»èµ„æ ¼ã€‚',
                    'èµ„æ–™éœ€ç™»å…¥å¸å·ä»¥æ­£ç¡®æ˜¾ç¤ºã€‚'
                ]
            },
            'en': {
                title: 'Live Games<br>Daily Diamond Rebate ğŸ’',
                subtitle: 'Play any live game and get rebates daily!',
                game_1: 'ğŸ‰ Dragon Tiger',
                game_2: 'ğŸ’ˆ Golden Gate',
                game_3: 'ğŸŒªï¸ Soaring High',
                hero_label: 'âœ¨ Est. Rebate (Diamonds)',
                daily_bet_label: 'Total Bet Today',
                status_label: 'Eligibility',
                rate_title: 'ğŸ“Š Rebate Rates',
                tier_3_range: '10M+',
                tier_2_range: '1M ~ 9.99M',
                tier_1_range: '5K ~ 990K',
                history_title: 'ğŸ“… Last 3 Days Records',
                table_date: 'Date',
                table_game: 'Game',
                table_amount: 'Total Bet',
                footer_title: 'â„¹ï¸ Rules',
                qualify_yes: 'âœ… Qualified',
                qualify_no: 'â³ Not Qualified',
                tier_current: 'Current Tier',
                tier_max: 'Max Tier Reached ğŸš€',
                tier_diff: '{n} to Next Tier',
                loading: 'Loading...',
                no_record: 'No records found',
                err_missing_title: 'âš ï¸ Missing User ID',
                err_missing_desc: 'Cannot find user_id. Please check the URL.',
                err_conn_title: 'Connection Error',
                err_conn_desc: 'Unable to connect to server. Please try again later.',
                err_data_title: 'Data Error',
                game_map: { 'é¾ä¹³é¬¥ç™½è™': 'Dragon Tiger', 'ä¸€æŸ±æ“å¤©': 'Golden Gate', 'é‡‘å°„ç‹‚é¢¨': 'Soaring High', 'ç•¶æ—¥åŠ ç¸½': 'Daily Total' },
                rules: [
                    'Daily total bet of <strong>5,000</strong> diamonds required to qualify for rebate.',
                    'Rebates are issued daily before 01:00 (UTC+8) the following day.',
                    'Example: Rebates for 11/28 will be issued before <span class="rule-highlight">11/29 01:00</span>.',
                    'Only valid bets on "Dragon Tiger", "Golden Gate", and "Soaring High" count.',
                    'Rebates are rounded to 1 decimal place. E.g., 52,400 bet * 0.7% = 366.8 -> <span class="rule-highlight">367</span> diamonds issued.',
                    'Abnormal betting patterns may result in disqualification.',
                    'Login required to view data.'
                ]
            },
            'jp': {
                title: 'ãƒ©ã‚¤ãƒ–ã‚²ãƒ¼ãƒ <br>æ¯æ—¥ãƒ€ã‚¤ãƒ¤é‚„å…ƒ ğŸ’',
                subtitle: 'å¯¾è±¡ã‚²ãƒ¼ãƒ ã‚’éŠã‚“ã§ã€æ¯æ—¥é‚„å…ƒã‚²ãƒƒãƒˆï¼',
                game_1: 'ğŸ‰ ãƒ‰ãƒ©ã‚´ãƒ³ã‚¿ã‚¤ã‚¬ãƒ¼',
                game_2: 'ğŸ’ˆ ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚²ãƒ¼ãƒˆ',
                game_3: 'ğŸŒªï¸ ã‚½ã‚¢ãƒªãƒ³ã‚°ãƒã‚¤',
                hero_label: 'âœ¨ æ˜æ—¥ã®äºˆæƒ³é‚„å…ƒ (ãƒ€ã‚¤ãƒ¤)',
                daily_bet_label: 'æœ¬æ—¥ã®ç·ãƒ™ãƒƒãƒˆ',
                status_label: 'ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹',
                rate_title: 'ğŸ“Š é‚„å…ƒç‡ãƒ†ãƒ¼ãƒ–ãƒ«',
                tier_3_range: '1,000 ä¸‡ä»¥ä¸Š',
                tier_2_range: '100 ä¸‡ ~ 999 ä¸‡',
                tier_1_range: '5,000 ~ 99 ä¸‡',
                history_title: 'ğŸ“… éå» 3 æ—¥é–“ã®å±¥æ­´',
                table_date: 'æ—¥ä»˜',
                table_game: 'ã‚²ãƒ¼ãƒ ',
                table_amount: 'ç·ãƒ™ãƒƒãƒˆ',
                footer_title: 'â„¹ï¸ ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°',
                qualify_yes: 'âœ… å¯¾è±¡',
                qualify_no: 'â³ æœªé”',
                tier_current: 'ç¾åœ¨ã®ãƒ©ãƒ³ã‚¯',
                tier_max: 'æœ€å¤§ãƒ©ãƒ³ã‚¯åˆ°é” ğŸš€',
                tier_diff: 'ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—ã¾ã§ {n}',
                loading: 'èª­ã¿è¾¼ã¿ä¸­...',
                no_record: 'å±¥æ­´ãªã—',
                err_missing_title: 'âš ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ä¸è¶³',
                err_missing_desc: 'User IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒªãƒ³ã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
                err_conn_title: 'é€šä¿¡ã‚¨ãƒ©ãƒ¼',
                err_conn_desc: 'ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚å¾Œã»ã©ãŠè©¦ã—ãã ã•ã„ã€‚',
                err_data_title: 'ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼',
                game_map: { 'é¾ä¹³é¬¥ç™½è™': 'ãƒ‰ãƒ©ã‚´ãƒ³ã‚¿ã‚¤ã‚¬ãƒ¼', 'ä¸€æŸ±æ“å¤©': 'ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚²ãƒ¼ãƒˆ', 'é‡‘å°„ç‹‚é¢¨': 'ã‚½ã‚¢ãƒªãƒ³ã‚°ãƒã‚¤', 'ç•¶æ—¥åŠ ç¸½': 'å½“æ—¥åˆè¨ˆ' },
                rules: [
                    'æ¯æ—¥ç·ãƒ™ãƒƒãƒˆé¡ <strong>5,000</strong> ãƒ€ã‚¤ãƒ¤ä»¥ä¸Šã§é‚„å…ƒå¯¾è±¡ã¨ãªã‚Šã¾ã™ã€‚',
                    'é‚„å…ƒã¯ç¿Œæ—¥ã® 01:00 (UTC+8) ã¾ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é…å¸ƒã•ã‚Œã¾ã™ã€‚',
                    'ä¾‹ï¼š11/28 åˆ†ã®é‚„å…ƒã¯ <span class="rule-highlight">11/29 01:00</span> ã¾ã§ã«é…å¸ƒã€‚',
                    'ã€Œãƒ‰ãƒ©ã‚´ãƒ³ã‚¿ã‚¤ã‚¬ãƒ¼ã€ã€Œã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚²ãƒ¼ãƒˆã€ã€Œã‚½ã‚¢ãƒªãƒ³ã‚°ãƒã‚¤ã€ã®æœ‰åŠ¹ãƒ™ãƒƒãƒˆã®ã¿ãŒå¯¾è±¡ã§ã™ã€‚',
                    'é‚„å…ƒé¡ã¯å°æ•°ç‚¹ç¬¬ä¸€ä½ã‚’å››æ¨äº”å…¥ã—ã¾ã™ã€‚ä¾‹ï¼š52,400 * 0.7% = 366.8 â†’ <span class="rule-highlight">367</span> ãƒ€ã‚¤ãƒ¤é…å¸ƒã€‚',
                    'ä¸æ­£ãªãƒ™ãƒƒãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒç¢ºèªã•ã‚ŒãŸå ´åˆã€è³‡æ ¼ãŒå–ã‚Šæ¶ˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚',
                    'ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚'
                ]
            }
        };

        // --- è‡ªå‹•åµæ¸¬èªè¨€ ---
        function detectAndSetLanguage() {
            const browserLang = navigator.language || navigator.userLanguage || 'zh-TW';
            const lowerLang = browserLang.toLowerCase();
            let defaultLang = 'zh-TW';

            if (lowerLang.includes('zh')) {
                if (lowerLang.includes('cn') || lowerLang.includes('sg') || lowerLang.includes('hans')) {
                    defaultLang = 'zh-CN';
                } else {
                    defaultLang = 'zh-TW';
                }
            } else if (lowerLang.startsWith('en')) {
                defaultLang = 'en';
            } else if (lowerLang.startsWith('ja')) {
                defaultLang = 'jp';
            }
            changeLang(defaultLang);
        }

        // --- é¡¯ç¤ºå ±éŒ¯ç•«é¢ ---
        function showError(type, debugInfo = '') {
            currentError = { type, debugInfo };
            const t = TRANSLATIONS[currentLang];
            
            let title = t.err_data_title;
            let desc = debugInfo;

            if (type === 'missing') {
                title = t.err_missing_title;
                desc = t.err_missing_desc;
            } else if (type === 'connection') {
                title = t.err_conn_title;
                desc = t.err_conn_desc;
            }

            const contentDiv = document.getElementById('app-content');
            contentDiv.innerHTML = `
                <div class="error-msg">
                    <h3>${title}</h3>
                    <p>${desc}</p>
                    ${debugInfo && type !== 'missing' ? `<p style="font-size:10px; color:#aaa; margin-top:10px;">${debugInfo}</p>` : ''}
                    ${type === 'missing' ? `<p style="font-size:10px; color:#aaa; margin-top:10px; word-break:break-all;">DEBUG URL: ${window.location.href}</p>` : ''}
                </div>
            `;
        }

        // --- åˆ‡æ›èªè¨€å‡½æ•¸ ---
        function changeLang(lang) {
            currentLang = lang;
            const t = TRANSLATIONS[lang];

            const btns = document.querySelectorAll('.lang-btn');
            btns.forEach(btn => btn.classList.remove('active'));
            if(lang === 'zh-TW') btns[0].classList.add('active');
            if(lang === 'zh-CN') btns[1].classList.add('active');
            if(lang === 'en') btns[2].classList.add('active');
            if(lang === 'jp') btns[3].classList.add('active');

            if (currentError) {
                showError(currentError.type, currentError.debugInfo);
                return;
            }

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.innerHTML = t[key];
            });

            const rulesList = document.getElementById('footer-rules-list');
            if (rulesList) {
                rulesList.innerHTML = '';
                t.rules.forEach(rule => {
                    const li = document.createElement('li');
                    li.innerHTML = rule;
                    rulesList.appendChild(li);
                });
            }

            const statusEl = document.getElementById('tier-status');
            if (statusEl && ["Loading...", "è¼‰å…¥ä¸­...", "åŠ è½½ä¸­...", "èª­ã¿è¾¼ã¿ä¸­..."].some(s => statusEl.innerText.includes(s) || statusEl.innerText === "Loading...")) {
               statusEl.innerText = t.loading;
            }

            if (cachedData) {
                renderDashboard(cachedData);
            }
        }

        // --- æ¸²æŸ“ä¸»ç¨‹å¼ ---
        function renderDashboard(data) {
            cachedData = data;
            const t = TRANSLATIONS[currentLang];

            document.querySelectorAll('.skeleton').forEach(el => el.classList.remove('skeleton'));

            document.getElementById('val-rebate').innerText = fmt(data.est_rebate);
            document.getElementById('val-total').innerText = fmt(data.total_bet);

            const qEl = document.getElementById('val-qualify');
            if (data.total_bet >= 5000) {
                qEl.innerText = t.qualify_yes;
                qEl.style.color = "var(--accent-green)";
            } else {
                qEl.innerText = t.qualify_no;
                qEl.style.color = "var(--text-muted)";
            }

            document.getElementById('progress-bar').style.width = `${data.progress_percent}%`;
            
            let statusText = `${t.tier_current} ${data.current_rate}%`;
            let diffText = "";
            if (data.next_tier_diff <= 0) {
                diffText = t.tier_max;
                document.getElementById('next-diff').style.color = "var(--accent-gold)";
            } else {
                diffText = t.tier_diff.replace('{n}', fmt(data.next_tier_diff));
                document.getElementById('next-diff').style.color = "var(--text-muted)";
            }
            document.getElementById('tier-status').innerText = statusText;
            document.getElementById('next-diff').innerText = diffText;

            document.querySelectorAll('.tier-item').forEach(el => el.classList.remove('active'));
            if (data.total_bet >= 10000000) document.getElementById('tier-3').classList.add('active');
            else if (data.total_bet >= 1000000) document.getElementById('tier-2').classList.add('active');
            else if (data.total_bet >= 5000) document.getElementById('tier-1').classList.add('active');

            const tbody = document.getElementById('history-tbody');
            tbody.innerHTML = '';

            if (!data.history_list || data.history_list.length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" style="text-align:center; padding:20px; color:var(--text-muted);">${t.no_record}</td></tr>`;
            } else {
                let lastDate = '';
                data.history_list.forEach(row => {
                    const tr = document.createElement('tr');
                    const isTotal = row.game_name === 'ç•¶æ—¥åŠ ç¸½';
                    if (isTotal) tr.classList.add('row-daily-total');

                    let dateHtml = row.date_str;
                    if (row.date_str === lastDate && !isTotal) {
                        dateHtml = '<span class="date-dim">"</span>';
                    } else {
                        lastDate = row.date_str;
                    }

                    let displayGameName = t.game_map[row.game_name] || row.game_name;

                    tr.innerHTML = `
                        <td style="color: var(--text-muted);">${dateHtml}</td>
                        <td class="col-game">${displayGameName}</td>
                        <td class="col-amount">${fmt(row.amount)}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        }

        // å•Ÿå‹•å‡½æ•¸
        async function init() {
            detectAndSetLanguage();

            try {
                let userId = null;
                const currentUrl = window.location.href;
                const regex = /(?:[?&#/]|^)user_id=([^&#]*)/i;
                const match = currentUrl.match(regex);
                if (match && match[1]) userId = match[1];

                if (!userId) {
                    try {
                        const decodedUrl = decodeURIComponent(currentUrl);
                        const matchDecoded = decodedUrl.match(regex);
                        if (matchDecoded && matchDecoded[1]) userId = matchDecoded[1];
                    } catch (e) {}
                }

                if (!userId) {
                    showError('missing');
                    return;
                }

                const response = await fetch(`${API_URL}?user_id=${encodeURIComponent(userId)}`, {
                    method: 'GET',
                    redirect: 'follow',
                    mode: 'cors',      
                    credentials: 'omit'
                });
                const json = await response.json();
                
                if (json.status === 'success') {
                    renderDashboard(json.data);
                } else {
                    console.error("API Error:", json.message);
                    showError('data', json.message);
                }

            } catch (e) {
                console.error("Init Error:", e);
                showError('connection', e.toString());
            }
        }

        init();
    </script>
</body>
</html>
