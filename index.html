<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diamond Rebate Dashboard</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500;700&family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+SC:wght@400;700&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-body: #0B0E14;
            --surface-glass: rgba(30, 35, 48, 0.85);
            --surface-solid: #1C212E;
            --border-subtle: rgba(255, 255, 255, 0.12);
            --accent-gold: #FACC15;
            --accent-gold-dim: rgba(250, 204, 21, 0.15);
            --accent-gold-glow: rgba(250, 204, 21, 0.35);
            --accent-green: #34D399;
            --accent-green-dim: rgba(52, 211, 153, 0.15);
            --accent-red: #F43F5E;
            --text-main: #FFFFFF;
            --text-muted: #9CA3AF;
            --text-dim: #6B7280;
            --text-highlight: #F3F4F6;
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 10px;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body {
            margin: 0;
            padding: 20px 20px 80px 20px;
            background-color: var(--bg-body);
            font-family: 'Inter', 'Noto Sans TC', 'Noto Sans SC', 'Noto Sans JP', sans-serif;
            color: var(--text-main);
            background-image: 
                radial-gradient(circle at 10% 10%, rgba(244, 63, 94, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 90% 90%, rgba(250, 204, 21, 0.08) 0%, transparent 50%);
            background-attachment: fixed;
            min-height: 100vh;
            font-size: 14px;
        }

        .dashboard-container {
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 24px; 
        }

        /* --- Language Switcher --- */
        .lang-switch-container {
            display: flex;
            justify-content: flex-end;
            gap: 6px;
            width: 100%;
            padding-bottom: 4px;
            z-index: 10;
        }

        .lang-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: var(--text-muted);
            padding: 4px 10px;
            border-radius: 14px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .lang-btn:active { transform: scale(0.95); }
        .lang-btn.active { 
            background: var(--accent-gold); 
            color: #000; 
            border-color: var(--accent-gold); 
            font-weight: 800; 
            box-shadow: 0 0 8px var(--accent-gold-glow); 
        }

        /* --- Header --- */
        .promo-header { 
            text-align: center; 
            margin-bottom: 12px;
        }
        
        .promo-title {
            margin: 0 0 10px 0; 
            font-size: 32px; 
            font-weight: 900;
            background: linear-gradient(135deg, #FFF 40%, var(--accent-gold) 100%);
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px; 
            line-height: 1.2;
        }
        
        .promo-subtitle { 
            font-size: 14px; 
            color: var(--text-muted); 
            margin: 0 0 18px 0; 
            line-height: 1.5;
        }
        
        .game-tags { display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; }
        .game-tag {
            font-size: 12px; 
            padding: 5px 12px; 
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.05); 
            border: 1px solid var(--border-subtle);
            color: var(--text-highlight); 
            display: flex; 
            align-items: center; 
            gap: 5px;
            white-space: nowrap;
        }

        /* --- Section Title --- */
        .section-title {
            font-size: 17px; 
            font-weight: 700; 
            color: var(--text-highlight);
            margin-top: 16px; 
            margin-bottom: 14px; 
            padding-left: 10px; 
            border-left: 4px solid var(--accent-gold); 
            line-height: 1.2;
        }

        /* --- Cards Common --- */
        .card {
            background: var(--surface-glass); 
            backdrop-filter: blur(24px); 
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--border-subtle); 
            border-radius: var(--radius-lg);
            overflow: hidden; 
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25); 
        }

        /* --- Hero Card --- */
        .hero-card {
            padding: 28px 24px; 
            text-align: center;
            background: linear-gradient(180deg, rgba(255,255,255,0.04) 0%, rgba(255,255,255,0) 100%);
            border: 1px solid rgba(250, 204, 21, 0.3); 
            box-shadow: 0 0 50px -10px rgba(250, 204, 21, 0.15);
        }
        
        .hero-label { 
            font-size: 14px; 
            color: var(--text-muted); 
            letter-spacing: 1px; 
            text-transform: uppercase; 
            margin-bottom: 10px; 
            font-weight: 600;
        }
        
        .hero-value { 
            font-size: 56px; 
            font-weight: 800; 
            color: var(--accent-gold); 
            text-shadow: 0 0 30px var(--accent-gold-glow); 
            margin: 0; 
            line-height: 1; 
            font-family: 'JetBrains Mono', monospace; 
            letter-spacing: -2px;
        }

        /* --- Bento Grid --- */
        .bento-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 14px; 
            margin-top: 14px; 
        }
        
        .stat-card { display: flex; flex-direction: column; justify-content: center; padding: 20px 18px; }
        .stat-label { font-size: 13px; color: var(--text-muted); margin-bottom: 6px; }
        .stat-value { font-size: 22px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }

        /* --- Progress Bar --- */
        .progress-section { margin-top: 28px; text-align: left; }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 13px; color: var(--text-muted); font-weight: 600; }
        .progress-track { height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent-gold), #FFF); width: 0%; border-radius: 10px; transition: width 1.2s cubic-bezier(0.34, 1.56, 0.64, 1); box-shadow: 0 0 15px var(--accent-gold-glow); }

        /* --- Tier List --- */
        .tier-list { display: flex; flex-direction: column; gap: 10px; }
        .tier-item { display: flex; justify-content: space-between; align-items: center; background: var(--surface-solid); padding: 16px 18px; border-radius: var(--radius-sm); border: 1px solid transparent; transition: all 0.3s; }
        .tier-item.active { background: var(--accent-gold-dim); border-color: rgba(250, 204, 21, 0.4); transform: scale(1.01); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .tier-range { font-size: 14px; color: var(--text-muted); font-weight: 500; }
        .tier-rate { font-size: 18px; font-weight: 800; color: var(--text-main); font-family: 'JetBrains Mono', monospace; }
        .tier-item.active .tier-rate { color: var(--accent-gold); }

        /* --- History Table (Separate æ¨¡å¼å®Œç¾ç‰ˆ) --- */
        .history-card { 
            padding: 0; 
            border: 1px solid var(--border-subtle); 
            border-radius: var(--radius-lg);
            overflow: hidden; 
            background: var(--surface-glass);
        }

        .history-table { 
            width: 100%; 
            /* ä½¿ç”¨ separate + border-spacing 0 ä¾†è§£æ±ºç·šæ¢èˆ‡åœ“è§’å•é¡Œ */
            border-collapse: separate; 
            border-spacing: 0;
            table-layout: fixed;
            font-size: 14px; 
            text-align: left; 
        }

        .history-table th { 
            background: rgba(255, 255, 255, 0.03); 
            color: var(--text-muted); 
            font-weight: 600; 
            padding: 14px 16px; 
            font-size: 12px; 
            text-transform: uppercase; 
            border-bottom: 1px solid var(--border-subtle); 
            white-space: nowrap;
        }

        .history-table td { 
            padding: 16px 16px; 
            border-bottom: 1px solid var(--border-subtle); 
            color: var(--text-main); 
            vertical-align: middle; 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ç§»é™¤æœ€å¾Œä¸€åˆ—çš„åº•ç·šï¼Œé¿å…é›™é‡é‚Šæ¡† */
        .history-table tbody tr:last-child td { 
            border-bottom: none; 
        }

        .col-amount { 
            text-align: right; 
            font-family: 'JetBrains Mono', monospace; 
            font-weight: 600; 
            letter-spacing: -0.5px; 
            font-size: 15px; 
        }
        
        /* ç•¶æ—¥åŠ ç¸½ Highlight (é‡‘è‰²) */
        .row-daily-total td { background: rgba(250, 204, 21, 0.06) !important; }
        .row-daily-total .col-game { color: var(--accent-gold); font-weight: 800; display: flex; align-items: center; gap: 6px; font-size: 14px; }
        .row-daily-total .col-game::before { content: 'âˆ‘'; font-weight: 400; opacity: 0.7; margin-right: 2px; font-size: 16px; }
        .row-daily-total .col-amount { color: var(--accent-gold); font-weight: 800; font-size: 16px; }

        /* ç•¶æ—¥è¿”æ°´ Highlight (ç¶ è‰²) */
        .row-daily-rebate td { background: var(--accent-green-dim) !important; }
        .row-daily-rebate .col-game { color: var(--accent-green); font-weight: 800; display: flex; align-items: center; gap: 6px; font-size: 14px; }
        .row-daily-rebate .col-game::before { content: 'ğŸ’'; font-weight: 400; opacity: 0.8; margin-right: 2px; font-size: 14px; }
        .row-daily-rebate .col-amount { color: var(--accent-green); font-weight: 800; font-size: 16px; }
        
        /* --- Footer --- */
        .footer-rules { margin-top: 40px; padding-top: 24px; border-top: 1px solid var(--border-subtle); color: var(--text-muted); }
        .footer-title { font-size: 14px; font-weight: 700; color: var(--text-dim); margin-bottom: 16px; text-transform: uppercase; letter-spacing: 1px; }
        .rules-list { list-style: none; padding: 0; margin: 0; font-size: 13px; line-height: 1.8; color: var(--text-muted); }
        .rules-list li { position: relative; padding-left: 16px; margin-bottom: 10px; }
        .rules-list li::before { content: "â€¢"; position: absolute; left: 0; color: var(--text-dim); font-size: 16px; line-height: 1.2; }
        .rule-highlight { color: var(--accent-gold); font-family: 'JetBrains Mono', monospace; background: var(--accent-gold-dim); padding: 2px 6px; border-radius: 4px; }
        .copyright { margin-top: 50px; text-align: center; font-size: 11px; color: var(--text-dim); opacity: 0.6; }

        /* --- Utilities --- */
        .skeleton { background: linear-gradient(90deg, rgba(255,255,255,0.03) 25%, rgba(255,255,255,0.08) 50%, rgba(255,255,255,0.03) 75%); background-size: 200% 100%; animation: pulse 1.5s infinite; color: transparent !important; border-radius: 4px; }
        .error-msg { text-align: center; padding: 30px 20px; color: var(--text-muted); background: rgba(255, 50, 50, 0.05); border-radius: var(--radius-md); border: 1px dashed rgba(255, 50, 50, 0.2); margin-top: 30px; font-size: 14px; line-height: 1.6; }
        @keyframes pulse { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body>

    <div class="dashboard-container">
        <div class="lang-switch-container">
            <button class="lang-btn active" onclick="changeLang('zh-TW')">ç¹</button>
            <button class="lang-btn" onclick="changeLang('zh-CN')">ç®€</button>
            <button class="lang-btn" onclick="changeLang('en')">EN</button>
            <button class="lang-btn" onclick="changeLang('jp')">JP</button>
        </div>
        <div id="app-content">
            <header class="promo-header">
                <h1 class="promo-title" data-i18n="title">ç›´æ’­é–“éŠæˆ²<br>å¤©å¤©è¿”é‘½çŸ³ ğŸ’</h1>
                <p class="promo-subtitle" data-i18n="subtitle">ç©ç›´æ’­é–“ä»»ä¸€æ¬¾éŠæˆ²ï¼Œå¤©å¤©è¿”é‘½çŸ³ï¼</p>
                <div class="game-tags">
                    <span class="game-tag" data-i18n="game_1">ğŸ‰ é¾ä¹³é¬¥ç™½è™</span>
                    <span class="game-tag" data-i18n="game_2">ğŸ’ˆ ä¸€æŸ±æ“å¤©</span>
                    <span class="game-tag" data-i18n="game_3">ğŸŒªï¸ é‡‘å°„ç‹‚é¢¨</span>
                </div>
            </header>
            <main>
                <div class="card hero-card">
                    <div class="hero-label" data-i18n="hero_label">âœ¨ é è¨ˆæ˜æ—¥è¿”æ°´ (é‘½)</div>
                    <div class="hero-value skeleton" id="val-rebate">00,000</div>
                    <div class="progress-section">
                        <div class="progress-header">
                            <span id="tier-status">Loading...</span>
                            <span id="next-diff">---</span>
                        </div>
                        <div class="progress-track">
                            <div class="progress-fill" id="progress-bar"></div>
                        </div>
                    </div>
                </div>
                <div class="bento-grid">
                    <div class="card stat-card">
                        <div class="stat-label" data-i18n="daily_bet_label">ä»Šæ—¥ä¸‹æ³¨ç¸½é»æ•¸</div>
                        <div class="stat-value skeleton" id="val-total">0</div>
                    </div>
                    <div class="card stat-card">
                        <div class="stat-label" data-i18n="status_label">ç•¶å‰æ´»å‹•è³‡æ ¼</div>
                        <div class="stat-value" id="val-qualify" style="font-size: 13px;">---</div>
                    </div>
                </div>
            </main>
            <section>
                <div class="section-title" data-i18n="rate_title">ğŸ“Š é‘½çŸ³å›é¥‹æ¯”ä¾‹</div>
                <div class="tier-list">
                    <div class="tier-item" id="tier-3">
                        <div class="tier-range" data-i18n="tier_3_range">1,000 è¬ä»¥ä¸Š</div>
                        <div class="tier-rate">1.8%</div>
                    </div>
                    <div class="tier-item" id="tier-2">
                        <div class="tier-range" data-i18n="tier_2_range">100 è¬ ~ 999 è¬</div>
                        <div class="tier-rate">1.4%</div>
                    </div>
                    <div class="tier-item" id="tier-1">
                        <div class="tier-range" data-i18n="tier_1_range">5,000 ~ 99 è¬</div>
                        <div class="tier-rate">0.7%</div>
                    </div>
                </div>
            </section>
            <section>
                <div class="section-title" data-i18n="history_title">ğŸ“… è¿‘ 3 æ—¥ä¸‹æ³¨ç´€éŒ„</div>
                <div class="card history-card">
                    <table class="history-table">
                        <!-- å›ºå®šæ¬„å¯¬æ¯”ä¾‹ï¼Œç¢ºä¿å°é½Š -->
                        <colgroup>
                            <col style="width: 20%;">
                            <col style="width: 45%;">
                            <col style="width: 35%;">
                        </colgroup>
                        <thead>
                            <tr>
                                <th data-i18n="table_date">æ—¥æœŸ</th>
                                <th data-i18n="table_game">éŠæˆ²</th>
                                <th class="col-amount" data-i18n="table_amount">ä¸‹æ³¨ç¸½é¡</th>
                            </tr>
                        </thead>
                        <tbody id="history-tbody">
                            <tr><td><div class="skeleton" style="width:30px; height:12px;"></div></td><td><div class="skeleton" style="width:80px; height:12px;"></div></td><td><div class="skeleton" style="width:50px; height:12px; float:right;"></div></td></tr>
                            <tr><td><div class="skeleton" style="width:30px; height:12px;"></div></td><td><div class="skeleton" style="width:80px; height:12px;"></div></td><td><div class="skeleton" style="width:50px; height:12px; float:right;"></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
            <footer class="footer-rules">
                <div class="footer-title" data-i18n="footer_title">â„¹ï¸ æ´»å‹•èªªæ˜</div>
                <ul class="rules-list" id="footer-rules-list"></ul>
                <div class="copyright">Â© 2025 SWAG. All Rights Reserved.</div>
            </footer>
        </div>
    </div>

    <script>
        // â˜…â˜…â˜… API (Cloud Run) â˜…â˜…â˜…
        const API_URL = 'https://game-rebate-api-905468082258.asia-east1.run.app';

        const fmt = (n) => new Intl.NumberFormat('en-US').format(n);
        let cachedData = null; 
        let currentLang = 'zh-TW';
        let currentError = null; 

        const TRANSLATIONS = {
            'zh-TW': {
                title: 'ç›´æ’­é–“éŠæˆ²<br>å¤©å¤©è¿”é‘½çŸ³ ğŸ’', subtitle: 'ç©ç›´æ’­é–“ä»»ä¸€æ¬¾éŠæˆ²ï¼Œå¤©å¤©è¿”é‘½çŸ³ï¼',
                game_1: 'ğŸ‰ é¾ä¹³é¬¥ç™½è™', game_2: 'ğŸ’ˆ ä¸€æŸ±æ“å¤©', game_3: 'ğŸŒªï¸ é‡‘å°„ç‹‚é¢¨',
                hero_label: 'âœ¨ é è¨ˆæ˜æ—¥è¿”æ°´ (é‘½)', daily_bet_label: 'ä»Šæ—¥ä¸‹æ³¨ç¸½é»æ•¸', status_label: 'ç•¶å‰æ´»å‹•è³‡æ ¼',
                rate_title: 'ğŸ“Š é‘½çŸ³å›é¥‹æ¯”ä¾‹', tier_3_range: '1,000 è¬ä»¥ä¸Š', tier_2_range: '100 è¬ ~ 999 è¬', tier_1_range: '5,000 ~ 99 è¬',
                history_title: 'ğŸ“… è¿‘ 3 æ—¥ä¸‹æ³¨ç´€éŒ„', table_date: 'æ—¥æœŸ', table_game: 'éŠæˆ²', table_amount: 'ä¸‹æ³¨ç¸½é¡',
                footer_title: 'â„¹ï¸ æ´»å‹•èªªæ˜', qualify_yes: 'âœ… ç¬¦åˆè³‡æ ¼', qualify_no: 'â³ å°šæœªé”æ¨™',
                tier_current: 'ç•¶å‰å±¤ç´š', tier_max: 'å·²é”æœ€é«˜å±¤ç´š ğŸš€', tier_diff: 'å·® {n} å‡ç´š', loading: 'è¼‰å…¥ä¸­...', no_record: 'å°šç„¡ç´€éŒ„',
                err_missing_title: 'âš ï¸ ç¼ºå°‘ç”¨æˆ¶è³‡è¨Š', err_missing_desc: 'ç„¡æ³•è®€å– User IDï¼Œè«‹ç¢ºèªé€£çµæ ¼å¼ã€‚',
                err_conn_title: 'é€£ç·šéŒ¯èª¤', err_conn_desc: 'ç„¡æ³•é€£æ¥è‡³ä¼ºæœå™¨ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚', err_data_title: 'æ•¸æ“šè®€å–å¤±æ•—',
                game_map: { 'é¾ä¹³é¬¥ç™½è™': 'é¾ä¹³é¬¥ç™½è™', 'ä¸€æŸ±æ“å¤©': 'ä¸€æŸ±æ“å¤©', 'é‡‘å°„ç‹‚é¢¨': 'é‡‘å°„ç‹‚é¢¨', 'ç•¶æ—¥åŠ ç¸½': 'ç•¶æ—¥åŠ ç¸½', 'ç•¶æ—¥è¿”æ°´': 'ç•¶æ—¥è¿”æ°´' },
                rules: ['æ´»å‹•æœŸé–“ï¼Œæ¯æ—¥ä¸‹æ³¨ç¸½é¡æ»¿ <strong>5,000</strong> é‘½çŸ³å³äº«é‘½çŸ³è¿”é‚„ã€‚', 'æ´»å‹•æœŸé–“æ—¥æ—¥è¿”é‘½ï¼Œéš”æ—¥ 01:00 å‰ç™¼æ”¾è‡³æ‰€å±¬å¸³è™Ÿå…§ã€‚', 'èˆ‰ä¾‹ï¼š<span class="rule-highlight">11/29 01:00</span> å‰ç™¼æ”¾ 11/28 å…¨å¤©çš„è¿”é‘½ï¼Œæ™‚å€ç‚º UTC+8ã€‚', 'åƒ…è¨ˆç›´æ’­é–“ä¸‰æ¬¾éŠæˆ²ï¼šã€Œé¾ä¹³é¬¥ç™½è™ã€ã€ã€Œä¸€æŸ±æ“å¤©ã€ã€ã€Œé‡‘å°„ç‹‚é¢¨ã€ çš„æœ‰æ•ˆæŠ•æ³¨åŠ ç¸½é‘½çŸ³æ•¸ã€‚', 'è¿”é‘½æ•¸é‡å››æ¨äº”å…¥å°æ•¸é»å¾Œä¸€ä½ã€‚èˆ‰ä¾‹ï¼šå‰æ—¥ä¸‹æ³¨ 52,400 é‘½æ¬¡æ—¥è¿”æ°´ç‚º 52,400 * 0.7% = 366.8ï¼Œå¯¦éš›å°‡ç™¼æ”¾ <span class="rule-highlight">367</span> é‘½ã€‚', 'æŠ•æ³¨æ¨¡å¼ç•°å¸¸è€…ï¼Œç³»çµ±æœ‰æ¬Šå–æ¶ˆè¿”é‘½è³‡æ ¼ã€‚', 'è³‡æ–™éœ€ç™»å…¥å¸³è™Ÿä»¥æ­£ç¢ºé¡¯ç¤ºã€‚']
            },
            'zh-CN': {
                title: 'ç›´æ’­é—´æ¸¸æˆ<br>å¤©å¤©è¿”é’»çŸ³ ğŸ’', subtitle: 'ç©ç›´æ’­é—´ä»»ä¸€æ¬¾æ¸¸æˆï¼Œå¤©å¤©è¿”é’»çŸ³ï¼',
                game_1: 'ğŸ‰ é¾™ä¹³æ–—ç™½è™', game_2: 'ğŸ’ˆ ä¸€æŸ±æ“å¤©', game_3: 'ğŸŒªï¸ é‡‘å°„ç‹‚é£',
                hero_label: 'âœ¨ é¢„è®¡æ˜æ—¥è¿”æ°´ (é’»)', daily_bet_label: 'ä»Šæ—¥ä¸‹æ³¨æ€»ç‚¹æ•°', status_label: 'å½“å‰æ´»åŠ¨èµ„æ ¼',
                rate_title: 'ğŸ“Š é’»çŸ³å›é¦ˆæ¯”ä¾‹', tier_3_range: '1,000 ä¸‡ä»¥ä¸Š', tier_2_range: '100 ä¸‡ ~ 999 ä¸‡', tier_1_range: '5,000 ~ 99 ä¸‡',
                history_title: 'ğŸ“… è¿‘ 3 æ—¥ä¸‹æ³¨çºªå½•', table_date: 'æ—¥æœŸ', table_game: 'æ¸¸æˆ', table_amount: 'ä¸‹æ³¨æ€»é¢',
                footer_title: 'â„¹ï¸ æ´»åŠ¨è¯´æ˜', qualify_yes: 'âœ… ç¬¦åˆèµ„æ ¼', qualify_no: 'â³ å°šæœªè¾¾æ ‡',
                tier_current: 'å½“å‰å±‚çº§', tier_max: 'å·²è¾¾æœ€é«˜å±‚çº§ ğŸš€', tier_diff: 'å·® {n} å‡çº§', loading: 'åŠ è½½ä¸­...', no_record: 'å°šæ— çºªå½•',
                err_missing_title: 'âš ï¸ ç¼ºå°‘ç”¨æˆ·ä¿¡æ¯', err_missing_desc: 'æ— æ³•è¯»å– User IDï¼Œè¯·ç¡®è®¤è¿ç»“æ ¼å¼ã€‚',
                err_conn_title: 'è¿æ¥é”™è¯¯', err_conn_desc: 'æ— æ³•è¿æ¥è‡³æœåŠ¡å™¨ï¼Œè¯·ç¨åå†è¯•ã€‚', err_data_title: 'æ•°æ®è¯»å–å¤±è´¥',
                game_map: { 'é¾ä¹³é¬¥ç™½è™': 'é¾™ä¹³æ–—ç™½è™', 'ä¸€æŸ±æ“å¤©': 'ä¸€æŸ±æ“å¤©', 'é‡‘å°„ç‹‚é¢¨': 'é‡‘å°„ç‹‚é£', 'ç•¶æ—¥åŠ ç¸½': 'å½“æ—¥åŠ æ€»', 'ç•¶æ—¥è¿”æ°´': 'å½“æ—¥è¿”æ°´' },
                rules: ['æ´»åŠ¨æœŸé—´ï¼Œæ¯æ—¥ä¸‹æ³¨æ€»é¢æ»¡ <strong>5,000</strong> é’»çŸ³å³äº«é’»çŸ³è¿”è¿˜ã€‚', 'æ´»åŠ¨æœŸé—´æ—¥æ—¥è¿”é’»ï¼Œéš”æ—¥ 01:00 å‰å‘æ”¾è‡³æ‰€å±å¸å·å†…ã€‚', 'ä¸¾ä¾‹ï¼š<span class="rule-highlight">11/29 01:00</span> å‰å‘æ”¾ 11/28 å…¨å¤©çš„è¿”é’»ï¼Œæ—¶åŒºä¸º UTC+8ã€‚', 'ä»…è®¡ç›´æ’­é—´ä¸‰æ¬¾æ¸¸æˆï¼šã€Œé¾™ä¹³æ–—ç™½è™ã€ã€ã€Œä¸€æŸ±æ“å¤©ã€ã€ã€Œé‡‘å°„ç‹‚é£ã€ çš„æœ‰æ•ˆæŠ•æ³¨åŠ æ€»é’»çŸ³æ•°ã€‚', 'è¿”é’»æ•°é‡å››èˆäº”å…¥å°æ•°ç‚¹åä¸€ä½ã€‚ä¸¾ä¾‹ï¼šå‰æ—¥ä¸‹æ³¨ 52,400 é’»æ¬¡æ—¥è¿”æ°´ä¸º 52,400 * 0.7% = 366.8ï¼Œå®é™…å°†å‘æ”¾ <span class="rule-highlight">367</span> é’»ã€‚', 'æŠ•æ³¨æ¨¡å¼å¼‚å¸¸è€…ï¼Œç³»ç»Ÿæœ‰æƒå–æ¶ˆè¿”é’»èµ„æ ¼ã€‚', 'èµ„æ–™éœ€ç™»å…¥å¸å·ä»¥æ­£ç¡®æ˜¾ç¤ºã€‚']
            },
            'en': {
                title: 'Live Games<br>Daily Diamond Rebate ğŸ’', subtitle: 'Play any live game and get rebates daily!',
                game_1: 'ğŸ‰ Dragon Tiger', game_2: 'ğŸ’ˆ Golden Gate', game_3: 'ğŸŒªï¸ Soaring High',
                hero_label: 'âœ¨ Est. Rebate (Diamonds)', daily_bet_label: 'Total Bet Today', status_label: 'Eligibility',
                rate_title: 'ğŸ“Š Rebate Rates', tier_3_range: '10M+', tier_2_range: '1M ~ 9.99M', tier_1_range: '5K ~ 990K',
                history_title: 'ğŸ“… Last 3 Days Records', table_date: 'Date', table_game: 'Game', table_amount: 'Total Bet',
                footer_title: 'â„¹ï¸ Rules', qualify_yes: 'âœ… Qualified', qualify_no: 'â³ Not Qualified',
                tier_current: 'Current Tier', tier_max: 'Max Tier Reached ğŸš€', tier_diff: '{n} to Next Tier', loading: 'Loading...', no_record: 'No records found',
                err_missing_title: 'âš ï¸ Missing User ID', err_missing_desc: 'Cannot find user_id. Please check the URL.',
                err_conn_title: 'Connection Error', err_conn_desc: 'Unable to connect to server. Please try again later.', err_data_title: 'Data Error',
                game_map: { 'é¾ä¹³é¬¥ç™½è™': 'Dragon Tiger', 'ä¸€æŸ±æ“å¤©': 'Golden Gate', 'é‡‘å°„ç‹‚é¢¨': 'Soaring High', 'ç•¶æ—¥åŠ ç¸½': 'Daily Total', 'ç•¶æ—¥è¿”æ°´': 'Daily Rebate' },
                rules: ['Daily total bet of <strong>5,000</strong> diamonds required to qualify for rebate.', 'Rebates are issued daily before 01:00 (UTC+8) the following day.', 'Example: Rebates for 11/28 will be issued before <span class="rule-highlight">11/29 01:00</span>.', 'Only valid bets on "Dragon Tiger", "Golden Gate", and "Soaring High" count.', 'Rebates are rounded to 1 decimal place. E.g., 52,400 bet * 0.7% = 366.8 -> <span class="rule-highlight">367</span> diamonds issued.', 'Abnormal betting patterns may result in disqualification.', 'Login required to view data.']
            },
            'jp': {
                title: 'ãƒ©ã‚¤ãƒ–ã‚²ãƒ¼ãƒ <br>æ¯æ—¥ãƒ€ã‚¤ãƒ¤é‚„å…ƒ ğŸ’', subtitle: 'å¯¾è±¡ã‚²ãƒ¼ãƒ ã‚’éŠã‚“ã§ã€æ¯æ—¥é‚„å…ƒã‚²ãƒƒãƒˆï¼',
                game_1: 'ğŸ‰ ãƒ‰ãƒ©ã‚´ãƒ³ã‚¿ã‚¤ã‚¬ãƒ¼', game_2: 'ğŸ’ˆ ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚²ãƒ¼ãƒˆ', game_3: 'ğŸŒªï¸ ã‚½ã‚¢ãƒªãƒ³ã‚°ãƒã‚¤',
                hero_label: 'âœ¨ æ˜æ—¥ã®äºˆæƒ³é‚„å…ƒ (ãƒ€ã‚¤ãƒ¤)', daily_bet_label: 'æœ¬æ—¥ã®ç·ãƒ™ãƒƒãƒˆ', status_label: 'ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹',
                rate_title: 'ğŸ“Š é‚„å…ƒç‡ãƒ†ãƒ¼ãƒ–ãƒ«', tier_3_range: '1,000 ä¸‡ä»¥ä¸Š', tier_2_range: '100 ä¸‡ ~ 999 ä¸‡', tier_1_range: '5,000 ~ 99 ä¸‡',
                history_title: 'ğŸ“… éå» 3 æ—¥é–“ã®å±¥æ­´', table_date: 'æ—¥ä»˜', table_game: 'ã‚²ãƒ¼ãƒ ', table_amount: 'ç·ãƒ™ãƒƒãƒˆ',
                footer_title: 'â„¹ï¸ ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°', qualify_yes: 'âœ… å¯¾è±¡', qualify_no: 'â³ æœªé”',
                tier_current: 'ç¾åœ¨ã®ãƒ©ãƒ³ã‚¯', tier_max: 'æœ€å¤§ãƒ©ãƒ³ã‚¯åˆ°é” ğŸš€', tier_diff: 'ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—ã¾ã§ {n}', loading: 'èª­ã¿è¾¼ã¿ä¸­...', no_record: 'å±¥æ­´ãªã—',
                err_missing_title: 'âš ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ä¸è¶³', err_missing_desc: 'User IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒªãƒ³ã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
                err_conn_title: 'é€šä¿¡ã‚¨ãƒ©ãƒ¼', err_conn_desc: 'ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚å¾Œã»ã©ãŠè©¦ã—ãã ã•ã„ã€‚', err_data_title: 'ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼',
                game_map: { 'é¾ä¹³é¬¥ç™½è™': 'ãƒ‰ãƒ©ã‚´ãƒ³ã‚¿ã‚¤ã‚¬ãƒ¼', 'ä¸€æŸ±æ“å¤©': 'ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚²ãƒ¼ãƒˆ', 'é‡‘å°„ç‹‚é¢¨': 'ã‚½ã‚¢ãƒªãƒ³ã‚°ãƒã‚¤', 'ç•¶æ—¥åŠ ç¸½': 'å½“æ—¥åˆè¨ˆ', 'ç•¶æ—¥è¿”æ°´': 'å½“æ—¥é‚„å…ƒ' },
                rules: ['æ¯æ—¥ç·ãƒ™ãƒƒãƒˆé¡ <strong>5,000</strong> ãƒ€ã‚¤ãƒ¤ä»¥ä¸Šã§é‚„å…ƒå¯¾è±¡ã¨ãªã‚Šã¾ã™ã€‚', 'é‚„å…ƒã¯ç¿Œæ—¥ã® 01:00 (UTC+8) ã¾ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é…å¸ƒã•ã‚Œã¾ã™ã€‚', 'ä¾‹ï¼š11/28 åˆ†ã®é‚„å…ƒã¯ <span class="rule-highlight">11/29 01:00</span> ã¾ã§ã«é…å¸ƒã€‚', 'ã€Œãƒ‰ãƒ©ã‚´ãƒ³ã‚¿ã‚¤ã‚¬ãƒ¼ã€ã€Œã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚²ãƒ¼ãƒˆã€ã€Œã‚½ã‚¢ãƒªãƒ³ã‚°ãƒã‚¤ã€ã®æœ‰åŠ¹ãƒ™ãƒƒãƒˆã®ã¿ãŒå¯¾è±¡ã§ã™ã€‚', 'é‚„å…ƒé¡ã¯å°æ•°ç‚¹ç¬¬ä¸€ä½ã‚’å››æ¨äº”å…¥ã—ã¾ã™ã€‚ä¾‹ï¼š52,400 * 0.7% = 366.8 â†’ <span class="rule-highlight">367</span> ãƒ€ã‚¤ãƒ¤é…å¸ƒã€‚', 'ä¸æ­£ãªãƒ™ãƒƒãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒç¢ºèªã•ã‚ŒãŸå ´åˆã€è³‡æ ¼ãŒå–ã‚Šæ¶ˆã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚', 'ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚']
            }
        };

        function detectAndSetLanguage() {
            const browserLang = navigator.language || navigator.userLanguage || 'zh-TW';
            const lowerLang = browserLang.toLowerCase();
            let defaultLang = 'zh-TW';
            if (lowerLang.includes('zh')) defaultLang = (lowerLang.includes('cn') || lowerLang.includes('sg')) ? 'zh-CN' : 'zh-TW';
            else if (lowerLang.startsWith('en')) defaultLang = 'en';
            else if (lowerLang.startsWith('ja')) defaultLang = 'jp';
            changeLang(defaultLang);
        }

        function showError(type, debugInfo = '') {
            currentError = { type, debugInfo };
            const t = TRANSLATIONS[currentLang];
            let title = t.err_data_title, desc = debugInfo;
            if (type === 'missing') { title = t.err_missing_title; desc = t.err_missing_desc; }
            else if (type === 'connection') { title = t.err_conn_title; desc = t.err_conn_desc; }
            document.getElementById('app-content').innerHTML = `<div class="error-msg"><h3>${title}</h3><p>${desc}</p>${debugInfo && type !== 'missing' ? `<p style="font-size:10px; color:#aaa; margin-top:10px;">${debugInfo}</p>` : ''}</div>`;
        }

        function changeLang(lang) {
            currentLang = lang;
            const t = TRANSLATIONS[lang];
            const btns = document.querySelectorAll('.lang-btn');
            btns.forEach(btn => btn.classList.remove('active'));
            if(lang === 'zh-TW') btns[0].classList.add('active');
            else if(lang === 'zh-CN') btns[1].classList.add('active');
            else if(lang === 'en') btns[2].classList.add('active');
            else if(lang === 'jp') btns[3].classList.add('active');

            if (currentError) { showError(currentError.type, currentError.debugInfo); return; }

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.innerHTML = t[key];
            });

            const rulesList = document.getElementById('footer-rules-list');
            if (rulesList) {
                rulesList.innerHTML = '';
                t.rules.forEach(rule => {
                    const li = document.createElement('li');
                    li.innerHTML = rule;
                    rulesList.appendChild(li);
                });
            }
            const statusEl = document.getElementById('tier-status');
            if (statusEl && statusEl.innerText.includes('...')) statusEl.innerText = t.loading;
            if (cachedData) renderDashboard(cachedData);
        }

        function renderDashboard(data) {
            cachedData = data;
            const t = TRANSLATIONS[currentLang];
            document.querySelectorAll('.skeleton').forEach(el => el.classList.remove('skeleton'));
            document.getElementById('val-rebate').innerText = fmt(data.est_rebate);
            document.getElementById('val-total').innerText = fmt(data.total_bet);
            
            const qEl = document.getElementById('val-qualify');
            qEl.innerText = data.total_bet >= 5000 ? t.qualify_yes : t.qualify_no;
            qEl.style.color = data.total_bet >= 5000 ? "var(--accent-green)" : "var(--text-muted)";

            document.getElementById('progress-bar').style.width = `${data.progress_percent}%`;
            let diffText = data.next_tier_diff <= 0 ? t.tier_max : t.tier_diff.replace('{n}', fmt(data.next_tier_diff));
            document.getElementById('tier-status').innerText = `${t.tier_current} ${data.current_rate}%`;
            document.getElementById('next-diff').innerText = diffText;
            document.getElementById('next-diff').style.color = data.next_tier_diff <= 0 ? "var(--accent-gold)" : "var(--text-muted)";

            document.querySelectorAll('.tier-item').forEach(el => el.classList.remove('active'));
            if (data.total_bet >= 10000000) document.getElementById('tier-3').classList.add('active');
            else if (data.total_bet >= 1000000) document.getElementById('tier-2').classList.add('active');
            else if (data.total_bet >= 5000) document.getElementById('tier-1').classList.add('active');

            const tbody = document.getElementById('history-tbody');
            tbody.innerHTML = '';
            if (!data.history_list || data.history_list.length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" style="text-align:center; padding:20px; color:var(--text-muted);">${t.no_record}</td></tr>`;
            } else {
                data.history_list.forEach(row => {
                    const tr = document.createElement('tr');
                    const isTotal = row.game_name === 'ç•¶æ—¥åŠ ç¸½';
                    const isRebate = row.game_name === 'ç•¶æ—¥è¿”æ°´';
                    
                    if (isTotal) tr.classList.add('row-daily-total');
                    if (isRebate) tr.classList.add('row-daily-rebate');
                    
                    // ç›´æ¥é¡¯ç¤ºæ‰€æœ‰æ—¥æœŸï¼Œä¸éš±è—
                    let dateHtml = row.date_str;

                    let displayGameName = t.game_map[row.game_name] || row.game_name;
                    tr.innerHTML = `<td style="color: var(--text-muted);">${dateHtml}</td><td class="col-game">${displayGameName}</td><td class="col-amount">${fmt(row.amount)}</td>`;
                    tbody.appendChild(tr);
                });
            }
        }

        async function init() {
            detectAndSetLanguage();
            try {
                let userId = null;
                const currentUrl = window.location.href;
                const regex = /(?:[?&#/]|^)user_id=([^&#]*)/i;
                const match = currentUrl.match(regex);
                if (match && match[1]) userId = match[1];
                if (!userId) {
                    try {
                        const decoded = decodeURIComponent(currentUrl);
                        const m2 = decoded.match(regex);
                        if (m2 && m2[1]) userId = m2[1];
                    } catch(e){}
                }
                if (!userId) { showError('missing'); return; }

                const response = await fetch(`${API_URL}?user_id=${encodeURIComponent(userId)}`, {
                    method: 'GET', redirect: 'follow', mode: 'cors', credentials: 'omit'
                });
                const json = await response.json();
                if (json.status === 'success') renderDashboard(json.data);
                else showError('data', json.message);
            } catch (e) {
                console.error(e);
                showError('connection', e.toString());
            }
        }
        init();
    </script>
</body>
</html>
