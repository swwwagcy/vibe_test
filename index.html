<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Èõô 12 Áõ¥Êí≠ÁãÇÊ≠° | Double 12 Live Carnival</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #050505;
            --bg-panel: #141416;
            --accent: #00d2be;
            --gold-start: #bf953f;
            --gold-mid: #fcf6ba;
            --gold-end: #b38728;
            --text-main: #ffffff;
            --text-sub: #d0d0d0;
            --border-color: rgba(255, 255, 255, 0.15);
            --row-height: 42px;
            --font-stack: 'Roboto', 'Noto Sans TC', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-stack);
            background-color: var(--bg-deep);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 20px 15px;
            background-image: 
                radial-gradient(circle at 50% 0%, rgba(0, 210, 190, 0.1) 0%, transparent 60%),
                linear-gradient(180deg, rgba(20,20,20,0) 0%, rgba(0,0,0,1) 100%);
            -webkit-font-smoothing: antialiased;
        }

        .container {
            width: 100%;
            max-width: 900px;
            position: relative;
            z-index: 2;
        }

        /* --- Diamond Styling --- */
        .d-emoji {
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            display: inline-block;
            line-height: 1;
            margin-left: 6px;
            position: relative;
            top: -0.12em; 
        }

        .d-cyan {
            filter: sepia(100%) hue-rotate(125deg) saturate(350%) brightness(1.1) drop-shadow(0 0 5px rgba(0, 210, 190, 0.4));
        }

        .d-gold-real {
            filter: sepia(100%) saturate(1000%) hue-rotate(10deg) brightness(1.2) contrast(1.1) drop-shadow(0 0 8px rgba(252, 246, 186, 0.6));
        }

        .d-label-icon { font-size: 0.75em; } 
        
        .d-hero { 
            font-size: 0.9em; 
            margin-right: 12px;
            margin-left: 0;
            top: 0;
        }

        /* --- Components --- */
        .lang-switch {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-bottom: 20px;
        }

        .lang-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
            color: #ccc;
            padding: 4px 14px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .lang-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: #000;
            font-weight: 700;
        }

        .hero {
            text-align: center;
            margin-bottom: 35px;
        }

        .date-badge {
            color: var(--accent);
            font-size: 0.9rem;
            letter-spacing: 2px;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 210, 190, 0.4);
        }

        h1 {
            font-size: clamp(2rem, 6vw, 3.5rem);
            font-weight: 900;
            margin-bottom: 15px;
            font-style: normal;
            text-transform: uppercase;
            color: #fff;
            text-shadow: 0 0 30px rgba(255,255,255,0.3);
            white-space: nowrap;
        }

        .marketing-box { margin-bottom: 20px; }

        .campaign-tag {
            display: inline-block;
            background: linear-gradient(90deg, transparent, rgba(0, 210, 190, 0.15), transparent);
            border-top: 1px solid var(--accent);
            border-bottom: 1px solid var(--accent);
            color: #fff;
            padding: 4px 20px;
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .campaign-highlight {
            font-size: 1.2rem;
            font-weight: 500;
            line-height: 1.8;
            color: #eee;
        }

        .gold-row {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 5px;
        }

        .gold-text {
            font-size: clamp(2.2rem, 10vw, 3.5rem);
            font-weight: 900;
            background: linear-gradient(to right, var(--gold-start), var(--gold-mid), var(--gold-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(252, 246, 186, 0.2);
            white-space: nowrap;
            line-height: 1;
        }

        .cta-btn {
            display: inline-block;
            background: var(--accent);
            color: #000;
            font-size: 1.1rem;
            font-weight: 700;
            padding: 12px 40px;
            border-radius: 50px;
            text-decoration: none;
            box-shadow: 0 0 20px rgba(0, 210, 190, 0.3);
            transition: all 0.2s;
            margin-top: 2px;
        }

        .cta-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 40px rgba(0, 210, 190, 0.5);
            background: #fff;
        }

        /* --- Dashboard --- */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr; 
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (max-width: 600px) {
            .dashboard { grid-template-columns: 1fr; }
        }

        .dash-card {
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            padding: 15px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
        }
        
        .dash-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
        }

        .dash-left { justify-content: space-evenly; }
        .dash-right { justify-content: center; }

        .stats-block { text-align: center; width: 100%; }

        .stats-label-group {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2px;
            line-height: 1.5;
        }

        .stats-label {
            color: var(--text-sub);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }

        .stats-val {
            line-height: 1;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 5px 15px rgba(0,0,0,0.5);
            font-family: 'Roboto', sans-serif;
            justify-content: center;
            display: flex;
            align-items: center;
        }

        .stats-val.rank-text { 
            font-size: clamp(2.5rem, 8vw, 3.2rem); 
            color: var(--accent); 
        }
        
        .stats-val.total-text { 
            font-size: clamp(2rem, 6vw, 2.5rem); 
            color: #fff; 
        }

        .divider {
            width: 60%;
            height: 1px;
            background: rgba(255,255,255,0.1);
            margin: 13px auto;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 44px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        .detail-row:last-child { border-bottom: none; }
        
        .d-label-group { display: flex; align-items: center; }
        .d-label { color: var(--text-sub); font-size: 0.9rem; font-weight: 500; }
        .d-val { 
            color: #fff; 
            font-weight: 700; 
            font-size: clamp(1rem, 4vw, 1.2rem);
            font-family: 'Roboto', sans-serif; 
        }

        /* --- Leaderboard --- */
        .split-header {
            display: grid;
            grid-template-columns: 1.4fr 1fr;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .col-header {
            background: #1a1a1d;
            padding: 12px;
            color: #fff;
            font-weight: 700;
            text-align: center;
            border-top: 3px solid var(--accent);
            font-size: 1.1rem;
            letter-spacing: 1px;
        }

        .split-body {
            display: grid;
            grid-template-columns: 1.4fr 1fr;
            background: var(--bg-panel);
            border: 1px solid var(--border-color);
            border-top: none;
        }

        @media (max-width: 768px) {
            .split-header, .split-body { grid-template-columns: 1.3fr 1fr; }
            .col-header { font-size: 0.9rem; padding: 10px 5px;}
        }

        .align-row {
            height: var(--row-height);
            display: flex;
            align-items: center;
            padding: 0 15px;
            border-bottom: 1px solid var(--border-color);
            font-size: 1rem;
        }
        
        .align-row:last-child { border-bottom: none; }

        .lb-col { border-right: 1px solid var(--border-color); }
        .lb-rank { width: 40px; font-weight: 900; color: #666; font-style: italic; font-size: 1.1rem; }
        
        .lb-score { 
            margin-left: auto; 
            color: #fff; 
            font-weight: 700; 
            font-family: 'Roboto', sans-serif;
        }
        
        .rank-1 { color: var(--gold-mid); text-shadow: 0 0 10px rgba(255, 215, 0, 0.4); font-size: 1.3rem; }
        .rank-2 { color: #e0e0e0; text-shadow: 0 0 10px rgba(255, 255, 255, 0.4); font-size: 1.3rem; }
        .rank-3 { color: #d4a58e; text-shadow: 0 0 10px rgba(212, 165, 142, 0.4); font-size: 1.3rem; }

        .r-val { 
            width: 100%; 
            display: flex;
            align-items: center;
            justify-content: flex-end; 
            color: var(--accent); 
            font-weight: 700; 
            font-family: 'Roboto', sans-serif; 
        }

        .rules-section {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.03);
            border-radius: 10px;
            color: #ccc;
        }
        .rules-title { font-weight: 700; color: #fff; margin-bottom: 15px; font-size: 1.1rem; border-left: 3px solid var(--accent); padding-left: 10px;}
        .rules-list { list-style: none; padding-left: 0; }
        .rules-list li {
            margin-bottom: 6px;
            line-height: 1.5;
            font-size: 0.9rem;
            padding-left: 20px;
            position: relative;
        }
        .rules-list li::before {
            content: '‚Ä¢';
            position: absolute;
            left: 0; top: 0;
            color: var(--accent);
            font-size: 1.5rem;
            line-height: 1.3rem;
        }

        /* Error Message Styling */
        .error-msg {
            text-align: center;
            padding: 30px 20px;
            background: rgba(255, 50, 50, 0.08);
            color: var(--text-sub);
            margin-bottom: 30px;
            border: 1px dashed rgba(255, 50, 50, 0.3);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .error-msg h3 {
            color: #ff8080;
            font-size: 1.2rem;
            margin: 0;
        }
        
        .error-msg p {
            margin: 0;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .error-debug {
            font-size: 0.8rem;
            color: #777;
            margin-top: 5px;
            font-family: monospace;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(2px);
            border-radius: 8px;
        }
        .spinner {
            width: 30px; height: 30px;
            border: 3px solid var(--accent);
            border-top: 3px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .hidden { display: none !important; }
        .val-blur { filter: blur(4px); opacity: 0.6; }
    </style>
</head>
<body>

    <div class="container">
        <div class="lang-switch">
            <button class="lang-btn active" onclick="setLang('tc')">ÁπÅÈ´î</button>
            <button class="lang-btn" onclick="setLang('sc')">ÁÆÄ‰Ωì</button>
            <button class="lang-btn" onclick="setLang('en')">EN</button>
            <button class="lang-btn" onclick="setLang('jp')">Êó•Êú¨Ë™û</button>
        </div>

        <div class="hero">
            <div class="date-badge" data-i18n="date">12/12 - 12/17</div>
            <h1 data-i18n="title">Èõô 12 Áõ¥Êí≠ÁãÇÊ≠°</h1>
            <div class="marketing-box">
                <div class="campaign-tag" data-i18n="subtitle">Áõ¥Êí≠ËÄóÈëΩÊéíË°åÊ¶ú</div>
                <div class="campaign-highlight">
                    <span data-i18n="desc_prefix">ÊáâÊè¥‰∫∫Ê∞£Â•≥Á•ûÂ•™Â§ßÁçéÔºåÂâçÂçÅÂêçÁìúÂàÜÁ∏ΩË®à</span><br>
                    <div class="gold-row">
                        <span class="d-emoji d-hero d-gold-real">üíé</span>
                        <span class="gold-text">550,000</span>
                    </div>
                </div>
            </div>
            <div>
                <a href="https://creators.swag.live/d12d" class="cta-btn" data-i18n="cta" target="_blank">Êü•Áúã‰∫∫Ê∞£Â•≥Á•ûÊ¥ªÂãï</a>
            </div>
        </div>

        <!-- Error Message Container (Initially Hidden) -->
        <div id="error-msg" class="error-msg hidden">
            <!-- Dynamic Content -->
        </div>

        <!-- Dashboard -->
        <div id="dashboard-container" class="dashboard" style="position: relative;">
            <!-- Loading Overlay -->
            <div id="loading-dash" class="loading-overlay hidden">
                <div class="spinner"></div>
            </div>

            <!-- Left: Rank & Total -->
            <div class="dash-card dash-left">
                <div class="stats-block">
                    <div class="stats-label" data-i18n="current_rank">Áï∂ÂâçÊéíÂêç</div>
                    <div class="stats-val rank-text" id="disp-rank">--</div>
                </div>
                <div class="divider"></div>
                <div class="stats-block">
                    <div class="stats-label-group">
                        <span class="stats-label" data-i18n="total_spent">Á∏ΩÊ∂àË≤ª</span>
                        <span class="d-emoji d-label-icon d-cyan">üíé</span>
                    </div>
                    <div class="stats-val total-text">
                        <span id="disp-total">0</span>
                    </div>
                </div>
            </div>

            <!-- Right: Details -->
            <div class="dash-card dash-right">
                <div class="detail-row">
                    <div class="d-label-group">
                        <span class="d-label" data-i18n="breakdown_gift">Áõ¥Êí≠Á¶ÆÁâ©</span>
                        <span class="d-emoji d-label-icon d-cyan">üíé</span>
                    </div>
                    <div class="d-val"><span id="disp-gift">0</span></div>
                </div>
                <div class="detail-row">
                    <div class="d-label-group">
                        <span class="d-label" data-i18n="breakdown_ticket">ÈôêÊôÇË°®Êºî</span>
                        <span class="d-emoji d-label-icon d-cyan">üíé</span>
                    </div>
                    <div class="d-val"><span id="disp-ticket">0</span></div>
                </div>
                <div class="detail-row">
                    <div class="d-label-group">
                        <span class="d-label" data-i18n="breakdown_menu">ÊåëÈÄóË°®Êºî</span>
                        <span class="d-emoji d-label-icon d-cyan">üíé</span>
                    </div>
                    <div class="d-val"><span id="disp-command">0</span></div>
                </div>
                <div class="detail-row">
                    <div class="d-label-group">
                        <span class="d-label" data-i18n="breakdown_lovense">ÈúáÂãïÊéßÂà∂</span>
                        <span class="d-emoji d-label-icon d-cyan">üíé</span>
                    </div>
                    <div class="d-val"><span id="disp-lovense">0</span></div>
                </div>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="split-header">
            <div class="col-header">
                <div class="header-content">
                    <span data-i18n="lb_title">Á∏ΩÈëΩÊéíË°åÊ¶ú</span>
                    <span class="d-emoji d-label-icon d-cyan">üíé</span>
                </div>
            </div>
            <div class="col-header">
                <div class="header-content">
                    <span data-i18n="rewards_title">ÊéíÂêçÁçéÂãµ</span>
                    <span class="d-emoji d-label-icon d-cyan">üíé</span>
                </div>
            </div>
        </div>
        <div class="split-body">
            <div class="lb-col" id="leaderboard-body"></div>
            <div class="reward-col" id="rewards-body"></div>
        </div>

        <!-- Rules -->
        <div class="rules-section">
            <div class="rules-title" data-i18n="rules_title">Ê¥ªÂãïË™™Êòé</div>
            <ul class="rules-list" id="rules-list"></ul>
        </div>
    </div>

    <script>
        // Integration Logic: API URL
        // ‰øÆÊ≠£ÔºöÁßªÈô§ÁµêÂ∞æÊñúÁ∑öÔºåÁ¢∫‰øùËàá Query String ÊãºÊé•Ê≠£Á¢∫
        const API_BASE_URL = "https://campaign-api-905468082258.asia-east1.run.app"; 

        let currentLang = 'tc';
        let currentErrorState = null; 

        const TRANSLATIONS = {
            tc: {
                date: "12/12 00:00 - 12/17 23:59 (GMT+8)",
                title: "Èõô 12 Áõ¥Êí≠ÁãÇÊ≠°",
                subtitle: "Áõ¥Êí≠ËÄóÈëΩÊéíË°åÊ¶ú",
                desc_prefix: "ÊáâÊè¥‰∫∫Ê∞£Â•≥Á•ûÂ•™Â§ßÁçéÔºåÂâçÂçÅÂêçÁìúÂàÜÁ∏ΩË®à",
                cta: "Êü•Áúã‰∫∫Ê∞£Â•≥Á•ûÊ¥ªÂãï",
                current_rank: "Áï∂ÂâçÊéíÂêç",
                total_spent: "Á∏ΩÊ∂àË≤ª",
                lb_title: "Á∏ΩÈëΩÊéíË°åÊ¶ú",
                rewards_title: "ÊéíÂêçÁçéÂãµ",
                breakdown_gift: "Áõ¥Êí≠Á¶ÆÁâ©",
                breakdown_ticket: "ÈôêÊôÇË°®Êºî",
                breakdown_menu: "ÊåëÈÄóË°®Êºî",
                breakdown_lovense: "ÈúáÂãïÊéßÂà∂",
                rules_title: "Ê¥ªÂãïË™™Êòé",
                // Error Messages
                err_missing_title: '‚ö†Ô∏è Áº∫Â∞ëÁî®Êà∂Ë≥áË®ä', 
                err_missing_desc: 'Ë´ãÁôªÂÖ• SWAG ÂæåÂÜç‰ΩøÁî®Êú¨È†ÅÈù¢„ÄÇ',
                err_conn_title: 'ÈÄ£Á∑öÈåØË™§', 
                err_conn_desc: 'ÁÑ°Ê≥ïÈÄ£Êé•Ëá≥‰º∫ÊúçÂô®ÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ', 
                err_data_title: 'Êï∏ÊìöËÆÄÂèñÂ§±Êïó',
                rules_list: [
                    "Áõ¥Êí≠ÈñìÁ∏ΩÈëΩÁü≥ÂÉÖË®àÁÆóÔºö„ÄåÁõ¥Êí≠Á¶ÆÁâ©„Äç„ÄÅ„ÄåÈôêÊôÇË°®ÊºîÁ•®Âà∏„Äç„ÄÅ„ÄåÊåëÈÄóË°®Êºî„Äç„ÄÅ„ÄåÈúáÂãïÊéßÂà∂„Äç„ÄÇ",
                    "ÊéíË°åÊ¶úÈëΩÁü≥Áõ∏ÂêåËÄÖÔºå‰ª•ÂÖàÈÅîÊàêËÄÖÊéíÂêçÂú®Ââç„ÄÇ",
                    "ÊéíÂêçÈëΩÁü≥ÁçéÂãµÂ∞áÊñºÊ¥ªÂãïÁµêÊùüÂæå 3 ÂÄãÂ∑•‰ΩúÂ§©ÂÖßÊ¥æÁôº„ÄÇ",
                    "Ë≥áÊñôÊõ¥Êñ∞Ëá≥Â∞ë 5 ÂàÜÈêòÔºåÈúÄÁôªÂÖ•Â∏≥Ëôü‰ª•Ê≠£Á¢∫È°ØÁ§∫„ÄÇ",
                    "ÊúÄÁµÇÁµêÊûú‰ª•ÂÆòÊñπË®àÁÆóÁÇ∫Ê∫ñ„ÄÇ"
                ]
            },
            sc: {
                date: "12/12 00:00 - 12/17 23:59 (GMT+8)",
                title: "Âèå 12 Áõ¥Êí≠ÁãÇÊ¨¢",
                subtitle: "Áõ¥Êí≠ËÄóÈíªÊéíË°åÊ¶ú",
                desc_prefix: "Â∫îÊè¥‰∫∫Ê∞îÂ•≥Á•ûÂ§∫Â§ßÂ•ñÔºåÂâçÂçÅÂêçÁìúÂàÜÊÄªËÆ°",
                cta: "Êü•Áúã‰∫∫Ê∞îÂ•≥Á•ûÊ¥ªÂä®",
                current_rank: "ÂΩìÂâçÊéíÂêç",
                total_spent: "ÊÄªÊ∂àË¥π",
                lb_title: "ÊÄªÈíªÊéíË°åÊ¶ú",
                rewards_title: "ÊéíÂêçÂ•ñÂä±",
                breakdown_gift: "Áõ¥Êí≠Á§ºÁâ©",
                breakdown_ticket: "ÈôêÊó∂Ë°®Êºî",
                breakdown_menu: "ÊåëÈÄóË°®Êºî",
                breakdown_lovense: "ÈúáÂä®ÊéßÂà∂",
                rules_title: "Ê¥ªÂä®ËØ¥Êòé",
                // Error Messages
                err_missing_title: '‚ö†Ô∏è Áº∫Â∞ëÁî®Êà∑‰ø°ÊÅØ', 
                err_missing_desc: 'ËØ∑ÁôªÂÖ• SWAG ÂêéÂÜç‰ΩøÁî®Êú¨È°µÈù¢„ÄÇ',
                err_conn_title: 'ËøûÊé•ÈîôËØØ', 
                err_conn_desc: 'Êó†Ê≥ïËøûÊé•Ëá≥ÊúçÂä°Âô®ÔºåËØ∑Á®çÂêéÂÜçËØï„ÄÇ', 
                err_data_title: 'Êï∞ÊçÆËØªÂèñÂ§±Ë¥•',
                rules_list: [
                    "Áõ¥Êí≠Èó¥ÊÄªÈíªÁü≥‰ªÖËÆ°ÁÆóÔºö‚ÄúÁõ¥Êí≠Á§ºÁâ©‚ÄùÔºå‚ÄúÈôêÊó∂Ë°®ÊºîÁ•®Âà∏‚ÄùÔºå‚ÄúÊåëÈÄóË°®Êºî‚ÄùÔºå‚ÄúÈúáÂä®ÊéßÂà∂‚Äù„ÄÇ",
                    "ÊéíË°åÊ¶úÈíªÁü≥Áõ∏ÂêåËÄÖÔºå‰ª•ÂÖàËææÊàêËÄÖÊéíÂêçÂú®Ââç„ÄÇ",
                    "ÊéíÂêçÈíªÁü≥Â•ñÂä±Â∞Ü‰∫éÊ¥ªÂä®ÁªìÊùüÂêé 3 ‰∏™Â∑•‰ΩúÂ§©ÂÜÖÊ¥æÂèë„ÄÇ",
                    "ËµÑÊñôÊõ¥Êñ∞Ëá≥Â∞ë 5 ÂàÜÈíüÔºåÈúÄÁôªÂÖ•Â∏êÂè∑‰ª•Ê≠£Á°ÆÊòæÁ§∫„ÄÇ",
                    "ÊúÄÁªàÁªìÊûú‰ª•ÂÆòÊñπËÆ°ÁÆó‰∏∫ÂáÜ„ÄÇ"
                ]
            },
            en: {
                date: "Dec 12 - Dec 17 (GMT+8)",
                title: "Double 12 Carnival",
                subtitle: "Diamond Spending Leaderboard",
                desc_prefix: "Support Goddesses & Win Big! Share total",
                cta: "View Event",
                current_rank: "Rank",
                total_spent: "Total",
                lb_title: "Total Diamond Leaderboard",
                rewards_title: "Rewards",
                breakdown_gift: "Livestream Gift",
                breakdown_ticket: "Paid Show",
                breakdown_menu: "Tease Show",
                breakdown_lovense: "Vibe Control",
                rules_title: "Rules",
                // Error Messages
                err_missing_title: '‚ö†Ô∏è Missing User ID', 
                err_missing_desc: 'Please log in to SWAG before using this page.',
                err_conn_title: 'Connection Error', 
                err_conn_desc: 'Unable to connect to server. Please try again later.', 
                err_data_title: 'Data Error',
                rules_list: [
                    "Total diamonds calculated from: 'Livestream Gift', 'Paid Show', 'Tease Show', 'Vibe Control' only.",
                    "If diamonds are equal, the first to achieve the amount ranks higher.",
                    "Rewards distributed within 3 working days after event ends.",
                    "Data delayed 5+ mins. Log in for accurate view.",
                    "Official calculation results are final."
                ]
            },
            jp: {
                date: "12/12 - 12/17 (GMT+8)",
                title: "„ÉÄ„Éñ„É´12 „Ç´„Éº„Éã„Éê„É´",
                subtitle: "„ÉÄ„Ç§„É§Ê∂àË≤ª„É©„É≥„Ç≠„É≥„Ç∞",
                desc_prefix: "Â•≥Á•û„ÇíÂøúÊè¥„Åó„Å¶Â§ßË≥û„ÇíÁãô„Åä„ÅÜÔºÅÁ∑èÈ°ç",
                cta: "„Ç§„Éô„É≥„Éà„ÇíË¶ã„Çã",
                current_rank: "ÁèæÂú®„ÅÆÈ†Ü‰Ωç",
                total_spent: "ÂêàË®àÊ∂àË≤ª",
                lb_title: "„É©„É≥„Ç≠„É≥„Ç∞",
                rewards_title: "„É©„É≥„Ç≠„É≥„Ç∞Â†±ÈÖ¨",
                breakdown_gift: "„ÇÆ„Éï„Éà",
                breakdown_ticket: "ÊúâÊñô„Ç∑„Éß„Éº",
                breakdown_menu: "„Çª„ÇØ„Ç∑„Éº„Ç∑„Éß„Éº",
                breakdown_lovense: "„É™„É¢„Éº„Éà„Éê„Ç§„Éñ",
                rules_title: "Ê≥®ÊÑè‰∫ãÈ†Ö",
                // Error Messages
                err_missing_title: '‚ö†Ô∏è „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±‰∏çË∂≥', 
                err_missing_desc: '„ÅîÂà©Áî®„Å´„ÅØ„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ',
                err_conn_title: 'ÈÄö‰ø°„Ç®„É©„Éº', 
                err_conn_desc: '„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì„ÄÇÂæå„Åª„Å©„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ', 
                err_data_title: '„Éá„Éº„Çø„Ç®„É©„Éº',
                rules_list: [
                    "ÂØæË±°Ôºö„Äé„ÇÆ„Éï„Éà„Äè„ÄÅ„ÄéÊúâÊñô„Ç∑„Éß„Éº„Äè„ÄÅ„Äé„Çª„ÇØ„Ç∑„Éº„Ç∑„Éß„Éº„Äè„ÄÅ„Äé„É™„É¢„Éº„Éà„Éê„Ç§„Éñ„Äè„ÅÆ„Åø„ÄÇ",
                    "Âêå„ÉÄ„Ç§„É§Êï∞„ÅÆÂ†¥Âêà„ÅØ„ÄÅÂÖà„Å´ÈÅîÊàê„Åó„ÅüÊñπ„Åå‰∏ä‰Ωç„Å®„Å™„Çä„Åæ„Åô„ÄÇ",
                    "Â†±ÈÖ¨„ÅØ„Ç§„Éô„É≥„ÉàÁµÇ‰∫ÜÂæå3Âñ∂Ê•≠Êó•‰ª•ÂÜÖ„Å´ÈÖçÂ∏É„Åï„Çå„Åæ„Åô„ÄÇ",
                    "„Éá„Éº„Çø„ÅØ5ÂàÜ‰ª•‰∏äÈÅÖÂª∂„ÄÇÊ≠£Á¢∫„Å™Ë°®Á§∫„Å´„ÅØ„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ",
                    "ÊúÄÁµÇÁµêÊûú„ÅØÂÖ¨Âºè„ÅÆÈõÜË®à„Å´Ê∫ñ„Åò„Åæ„Åô„ÄÇ"
                ]
            }
        };

        const MOCK_LEADERBOARD = [
            { rank: 1, user_id: '...', total_diamond_cost: 0 },
            { rank: 2, user_id: '...', total_diamond_cost: 0 },
            { rank: 3, user_id: '...', total_diamond_cost: 0 },
            { rank: 4, user_id: '...', total_diamond_cost: 0 },
            { rank: 5, user_id: '...', total_diamond_cost: 0 },
            { rank: 6, user_id: '...', total_diamond_cost: 0 },
            { rank: 7, user_id: '...', total_diamond_cost: 0 },
            { rank: 8, user_id: '...', total_diamond_cost: 0 },
            { rank: 9, user_id: '...', total_diamond_cost: 0 },
            { rank: 10, user_id: '...', total_diamond_cost: 0 }
        ];

        const REWARDS = [100000, 90000, 80000, 70000, 60000, 50000, 40000, 30000, 20000, 10000];
        let currentLeaderboard = [...MOCK_LEADERBOARD];

        function setLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (
                    (lang === 'tc' && btn.innerText.includes('ÁπÅ')) ||
                    (lang === 'sc' && btn.innerText.includes('ÁÆÄ')) ||
                    (lang === 'en' && btn.innerText.includes('EN')) ||
                    (lang === 'jp' && btn.innerText.includes('Êó•'))
                ) {
                    btn.classList.add('active');
                }
            });

            if (currentErrorState) {
                showError(currentErrorState.type, currentErrorState.debugInfo);
            }

            const t = TRANSLATIONS[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.innerHTML = t[key];
            });

            const rulesContainer = document.getElementById('rules-list');
            rulesContainer.innerHTML = '';
            t.rules_list.forEach(rule => {
                const li = document.createElement('li');
                li.textContent = rule;
                rulesContainer.appendChild(li);
            });
        }

        function showError(type, debugInfo = '') {
            currentErrorState = { type, debugInfo };
            const t = TRANSLATIONS[currentLang];
            let title = t.err_data_title;
            let desc = debugInfo;
            
            if (type === 'missing') {
                title = t.err_missing_title;
                desc = t.err_missing_desc;
            } else if (type === 'connection') {
                title = t.err_conn_title;
                desc = t.err_conn_desc;
            }

            const errorEl = document.getElementById('error-msg');
            errorEl.innerHTML = `<h3>${title}</h3><p>${desc}</p>${debugInfo && type !== 'missing' ? `<div class="error-debug">${debugInfo}</div>` : ''}`;
            errorEl.classList.remove('hidden');
            document.getElementById('dashboard-container').classList.add('hidden');
        }

        function renderTables() {
            const lbBody = document.getElementById('leaderboard-body');
            lbBody.innerHTML = '';
            
            currentLeaderboard.forEach(item => {
                let rankClass = '';
                if(item.rank === 1) rankClass = 'rank-1';
                else if(item.rank === 2) rankClass = 'rank-2';
                else if(item.rank === 3) rankClass = 'rank-3';

                const div = document.createElement('div');
                div.className = 'align-row';
                const scoreText = item.total_diamond_cost > 0 ? item.total_diamond_cost.toLocaleString() : '-';
                
                div.innerHTML = `
                    <span class="lb-rank ${rankClass}">${item.rank}</span>
                    <span class="lb-score">${scoreText}</span>
                `;
                lbBody.appendChild(div);
            });

            const rewardsBody = document.getElementById('rewards-body');
            rewardsBody.innerHTML = '';
            REWARDS.forEach((val) => {
                const div = document.createElement('div');
                div.className = 'align-row';
                div.innerHTML = `<div class="r-val">${val.toLocaleString()}</div>`;
                rewardsBody.appendChild(div);
            });
        }

        // --- ‰øÆÊ≠£ÈáçÈªû: Ëàá 001 ÂÆåÂÖ®‰∏ÄËá¥ÁöÑ ID Ëß£ÊûêÈÇèËºØ (Âê´ decode) ---
        function getUserId() {
            let userId = null;
            const currentUrl = window.location.href;
            
            // ‰ΩøÁî® 001 ÁöÑ RegexÔºåÊîØÊè¥ ?, &, #, / ÈñãÈ†≠
            const regex = /(?:[?&#/]|^)user_id=([^&#]*)/i;
            
            const match = currentUrl.match(regex);
            if (match && match[1]) {
                userId = match[1];
            }

            // Â¶ÇÊûúÊâæ‰∏çÂà∞ÔºåÂòóË©¶Ëß£Á¢ºÁ∂≤ÂùÄÂÜçÊâæ‰∏ÄÊ¨° (iframe Â∏∏Ë¶ãÂïèÈ°å)
            if (!userId) {
                try {
                    const decoded = decodeURIComponent(currentUrl);
                    const m2 = decoded.match(regex);
                    if (m2 && m2[1]) userId = m2[1];
                } catch(e) {
                    console.error("Decode URL failed", e);
                }
            }

            return userId;
        }

        async function fetchUserData() {
            const userId = getUserId();
            const errorEl = document.getElementById('error-msg');
            const loader = document.getElementById('loading-dash');
            const dashContainer = document.getElementById('dashboard-container');
            
            errorEl.classList.add('hidden');
            dashContainer.classList.remove('hidden');

            if (!userId) {
                showError('missing');
                renderTables();
                return;
            }

            loader.classList.remove('hidden');

            const resetDashboard = () => {
                document.getElementById('disp-rank').textContent = '--';
                document.getElementById('disp-total').textContent = '0';
                ['gift', 'ticket', 'command', 'lovense'].forEach(id => {
                    document.getElementById(`disp-${id}`).textContent = '0';
                });
            };

            try {
                // --- ‰øÆÊ≠£ÈáçÈªû: ÁßªÈô§ URL ÊñúÁ∑öÔºåÊ≠£Á¢∫ÊãºÊé•ÂèÉÊï∏ ---
                const fetchUrl = `${API_BASE_URL}?user_id=${encodeURIComponent(userId)}`;

                // --- ‰øÆÊ≠£ÈáçÈªû: Fetch Options Ëàá 001 ‰∏ÄËá¥ ---
                const response = await fetch(fetchUrl, {
                    method: 'GET',
                    redirect: 'follow', // ËôïÁêÜ Redirect
                    mode: 'cors',       // ÊòéÁ¢∫ÂÆ£Âëä CORS
                    credentials: 'omit' // ÈÅøÂÖçÈÄÅÂá∫ cookie
                });

                if (response.status === 404) {
                    resetDashboard();
                    renderTables(); 
                    return;
                }

                if (!response.ok) throw new Error(`API Status: ${response.status}`);

                const data = await response.json();

                if (data.user_stats) {
                    document.getElementById('disp-rank').textContent = data.user_stats.rank;
                    document.getElementById('disp-total').textContent = (data.user_stats.total_diamond_cost || 0).toLocaleString();
                    
                    if (data.user_stats.breakdown) {
                        const bd = data.user_stats.breakdown;
                        document.getElementById('disp-gift').textContent = (bd.livestream_gift_diamonds || 0).toLocaleString();
                        document.getElementById('disp-ticket').textContent = (bd.show_ticket_diamonds || 0).toLocaleString();
                        document.getElementById('disp-command').textContent = (bd.command_diamonds || 0).toLocaleString();
                        document.getElementById('disp-lovense').textContent = (bd.lovense_diamonds || 0).toLocaleString();
                    }
                } else {
                    resetDashboard();
                }

                if (data.leaderboard_top_10 && Array.isArray(data.leaderboard_top_10) && data.leaderboard_top_10.length > 0) {
                    currentLeaderboard = data.leaderboard_top_10;
                    renderTables();
                }

            } catch (err) {
                console.error("Fetch error:", err);
                showError('connection', err.toString());
                resetDashboard();
                renderTables(); 
            } finally {
                loader.classList.add('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            setLang('tc');
            renderTables();
            fetchUserData();
        });
    </script>
</body>
</html>
